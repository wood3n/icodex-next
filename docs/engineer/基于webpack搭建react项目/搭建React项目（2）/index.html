<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-engineer/基于webpack搭建react项目/搭建React项目（2）">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">搭建 React 项目（2） | icodex</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://icodex.me/docs/engineer/基于webpack搭建react项目/搭建React项目（2）"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="keywords" content="frontend, react, javascript, css, react, vue, typescript, docusaurus, blog, personal blog, personal website"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="搭建 React 项目（2） | icodex"><meta data-rh="true" name="description" content="之前通过一些 webpack 的简单配置，项目可以使用 React 来编写基本组件了，但是每次编写组件，都需要重新执行webpack命令打包，然后再手动在浏览器中打开页面才能看到开发结果，这是十分影响开发效率的，我们要的效果yarn start启动项目运行，在开发过程中使用ctrl+s保存文件，然后页面能自动更新，为此需要配置 HMR 和 webpack-dev-server。"><meta data-rh="true" property="og:description" content="之前通过一些 webpack 的简单配置，项目可以使用 React 来编写基本组件了，但是每次编写组件，都需要重新执行webpack命令打包，然后再手动在浏览器中打开页面才能看到开发结果，这是十分影响开发效率的，我们要的效果yarn start启动项目运行，在开发过程中使用ctrl+s保存文件，然后页面能自动更新，为此需要配置 HMR 和 webpack-dev-server。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://icodex.me/docs/engineer/基于webpack搭建react项目/搭建React项目（2）"><link data-rh="true" rel="alternate" href="https://icodex.me/docs/engineer/基于webpack搭建react项目/搭建React项目（2）" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://icodex.me/docs/engineer/基于webpack搭建react项目/搭建React项目（2）" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GMKEEJO8X4-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="icodex RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="icodex Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153188913-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-153188913-1",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="icodex" href="/opensearch.xml">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.596c1d98.css">
<link rel="preload" href="/assets/js/runtime~main.37c10f68.js" as="script">
<link rel="preload" href="/assets/js/main.777d231b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="icodex" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="icodex" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">icodex</b></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/pages/project">My Project</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Skill</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/javascript/guides">JavaScript</a></li><li><a class="dropdown__link" href="/docs/css/guides">CSS</a></li><li><a class="dropdown__link" href="/docs/typescript">TypeScript</a></li><li><a class="dropdown__link" href="/docs/react/guides">React</a></li><li><a class="dropdown__link" href="/docs/nodejs/awesome-nodejs">NodeJS</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/network/guides">Network</a></li><li><a class="dropdown__link" href="/docs/algorithm/算法分析">Algorithm</a></li><li><a class="dropdown__link" href="/docs/interview/guides">Interview</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/engineer/guides">Engineer</a><a class="navbar__item navbar__link" href="/docs/tools/git">Tool</a><a href="https://github.com/wood3n/icodex-next" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="icodex" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="icodex" class="themedImage_ToTc themedImage--dark_i4oU"><b>icodex</b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/engineer/guides">前端工程化体系</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/engineer/Babel/babel plugin编写">Babel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/electron1">electron</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/git hooks">git hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/guides">目录</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/eslintconfig">linter</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/rollupplugin1">roolup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/viteplugin1">vite</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/engineer/vscode插件开发/vsex1">vscode插件开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/webpack5">webpack5配置</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/engineer/webpack优化/webpack优化（1）">webpack优化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/webpackloader">webpack原理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/enhancedweb1">web性能优化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/engineer/使用yeoman搭建脚手架/脚手架搭建（1）">使用yeoman搭建脚手架</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/engineer/图标库搭建/svg">图标库搭建</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（1）">基于webpack搭建react项目</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（1）">搭建 React 项目（1）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（2）">搭建 React 项目（2）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（3）">搭建 React 项目（3）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（4）">搭建 React 项目（4）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（5）">搭建 React 项目（5）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（6）">搭建 React 项目（6）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（7）">搭建 React 项目（7）</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/engineer/模块语法/CSS模块语法">模块语法</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/跨域解决方式">跨域与解决方案</a></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/engineer/guides"><span itemprop="name">前端工程化体系</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">基于webpack搭建react项目</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">搭建 React 项目（2）</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>搭建 React 项目（2）</h1></header><p>之前通过一些 webpack 的简单配置，项目可以使用 React 来编写基本组件了，但是每次编写组件，都需要重新执行<code>webpack</code>命令打包，然后再手动在浏览器中打开页面才能看到开发结果，这是十分影响开发效率的，我们要的效果<code>yarn start</code>启动项目运行，在开发过程中使用<code>ctrl+s</code>保存文件，然后页面能自动更新，为此需要配置 HMR 和 <code>webpack-dev-server</code>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="开发模式">开发模式<a class="hash-link" href="#开发模式" title="标题的直接链接">​</a></h2><blockquote><p><a href="https://webpack.docschina.org/configuration/mode/" target="_blank" rel="noopener noreferrer">模式（Mode）</a></p></blockquote><p>如果要使用开发模式的功能，需要为 webpack 指定开发模式，因为执行<code>webpack</code>命令的时候如果不指定模式，那么默认就是生产环境<code>production</code>。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;development&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>针对不同的模式，webpack 使用相应模式的内置优化，例如开启一些内置的<code>plugin</code>等，具体如下：</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="development">development<a class="hash-link" href="#development" title="标题的直接链接">​</a></h3><ul><li><p>在<code>DefinePlugin</code>中注册全局环境变量属性<code>process.env.NODE_ENV = &quot;development&quot;</code></p></li><li><p>启用<code>NamedChunksPlugin</code></p></li><li><p>启用<code>NamedModulesPlugin</code></p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="production">production<a class="hash-link" href="#production" title="标题的直接链接">​</a></h3><ul><li>在<code>DefinePlugin</code>中注册全局环境变量属性<code>process.env.NODE_ENV = &quot;production&quot;</code></li><li>启用<code>FlagDependencyUsagePlugin</code>，用于标记当前模块中<code>import</code>部分使用到的<code>import</code>，后续可以删除无用的<code>import</code></li><li>启用<a href="https://webpack.js.org/plugins/internal-plugins/#flagincludedchunksplugin" target="_blank" rel="noopener noreferrer"><code>FlagIncludedChunksPlugin</code></a>，用于为每个 chunk 引入的其它 chunks 添加 id，消除无用的 chunk</li><li>启用<a href="https://webpack.docschina.org/plugins/module-concatenation-plugin/#root" target="_blank" rel="noopener noreferrer"><code>ModuleConcatenationPlugin</code></a>，将所有模块连接到一个闭包函数内，可以提高代码的执行效率，这个插件是开启 <em>tree shaking</em>功能必须启用的插件</li><li>启用<a href="https://www.webpackjs.com/plugins/no-emit-on-errors-plugin/" target="_blank" rel="noopener noreferrer"><code>NoEmitOnErrorsPlugin</code></a>，在编译出现错误时，使用 <code>NoEmitOnErrorsPlugin</code> 来跳过输出阶段。这样可以确保输出资源不会包含错误</li><li>启用<code>OccurrenceOrderPlugin</code>，这个插件以前叫<code>OccurenceOrderPlugin</code>，通过模块调用次数给模块分配 ids，常用的 ids 就会分配更短的 id，使 ids 可预测，减小文件大小</li><li>启用<code>SideEffectsFlagPlugin</code>，副作用代码标记，配合<code>package.json</code> 的<code>&quot;sideEffects&quot;</code>配置项使用，对于无副作用的代码，可以删除一些无用的<code>export</code>导出</li><li>启用<a href="https://webpack.js.org/plugins/terser-webpack-plugin/" target="_blank" rel="noopener noreferrer"><code>TerserPlugin</code></a>，使用 <a href="https://github.com/terser-js/terser" target="_blank" rel="noopener noreferrer">terser</a> 压缩 JS 代码</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="针对不同模式的配置">针对不同模式的配置<a class="hash-link" href="#针对不同模式的配置" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="函数配置">函数配置<a class="hash-link" href="#函数配置" title="标题的直接链接">​</a></h4><p>webpack 支持多种<a href="https://www.webpackjs.com/configuration/configuration-types/#%E5%AF%BC%E5%87%BA%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0" target="_blank" rel="noopener noreferrer">配置类型</a>，一般来说简单配置的话，都可以使用<code>module.exports</code>导出一个 webpack 配置对象的方式来做，但是对于复杂业务情况，例如需要针对不同环境启用不同的<code>loader</code>，<code>plugin</code>等功能，这时候需要使用 webpack 的函数配置方式来解决。</p><p>webpack 函数方式的配置可以接受两个参数：</p><ul><li>第一个参数是一个<a href="https://webpack.docschina.org/guides/environment-variables/" target="_blank" rel="noopener noreferrer">环境变量</a>对象<code>env</code>，内置一些环境变量属性，webpack 命令行 <a href="https://webpack.docschina.org/api/cli/#environment-options" target="_blank" rel="noopener noreferrer">环境配置</a> 的 <code>--env</code> 参数，可以允许你传入任意数量的环境变量。而在 <code>webpack.config.js</code> 中可以访问到这些环境变量</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// 执行webpack命令，并指定生产环境，并配置环境变量NODE_ENV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webpack </span><span class="token operator">--</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">NODE_ENV</span><span class="token operator">=</span><span class="token plain">development </span><span class="token operator">--</span><span class="token plain">progress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>第二个参数是一个 map 对象（<code>argv</code>），可以从<code>argv</code>中获取配置项信息传递到 webpack 的配置中</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// webpack.config.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(80, 250, 123)">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">env</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> argv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// 接受NODE_ENV环境变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">NODE_ENV</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">NODE_ENV</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// 判断执行命令时为webpack指定的环境模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token plain"> env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">production</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;development&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token class-name">optimize</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token class-name">UglifyJsPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// 通过argv传递参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">compress</span><span class="token operator">:</span><span class="token plain"> argv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;optimize-minimize&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不同的配置文件">不同的配置文件<a class="hash-link" href="#不同的配置文件" title="标题的直接链接">​</a></h4><p>如果不想都在一个<code>webpack.config.js</code>中杂糅所有配置项，出于维护性更高的目的，可以使用<a href="https://webpack.docschina.org/configuration/#use-different-configuration-file" target="_blank" rel="noopener noreferrer">不同的 webpack 配置文件</a>，例如开发环境指定<code>webpack.development.config.js</code>，并在执行<code>webpack</code>命令的时候通过命令行接口参数<code>--config</code>指定使用不同的配置文件。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// 指定使用配置文件，config后面串接配置文件路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webpack </span><span class="token operator">--</span><span class="token plain">config webpack</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 指定config文件夹中的webpack.development.config.js文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webpack </span><span class="token operator">--</span><span class="token plain">config config</span><span class="token operator">/</span><span class="token plain">webpack</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">development</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不同模式的切换">不同模式的切换<a class="hash-link" href="#不同模式的切换" title="标题的直接链接">​</a></h3><p>如果直接在<code>webpack.config.js</code>的<code>mode</code>配置项中写死在 webpack 不同模式中自由的切换，一般来说有两种方式：</p><ul><li>第一种是在执行<code>webpack</code>命令的时候，通过 webpack 提供的<a href="https://webpack.docschina.org/api/cli/#environment-options" target="_blank" rel="noopener noreferrer">命令行接口</a>参数<code>--mode</code>指定模式</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// 指定开发模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webpack </span><span class="token operator">--</span><span class="token plain">mode</span><span class="token operator">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 指定开发模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webpack </span><span class="token operator">--</span><span class="token plain">mode</span><span class="token operator">=</span><span class="token plain">production</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>第二种方式也是通过 webpack 提供的命令行接口参数<code>--mode</code>指定模式，不过结合了<a href="https://docs.npmjs.com/misc/scripts.html" target="_blank" rel="noopener noreferrer">npm-scripts</a>在<code>package.json</code>文件中配置命令，这样就能通过<code>npm run xxx</code>或者<code>yarn xxx</code>来指定 webpack 的模式了</li></ul><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webpack --mode=development&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;build&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webpack --mode=production&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>最后一种是推荐方式，上文说过，webpack 支持函数配置方式，函数可以接受使用命令行接口参数<code>--env</code>传递的环境变量对象，所以这种方式是通过在 npm-scripts 中配置启动命令，传递给 webpack 配置函数的<code>env</code>环境对象，然后在函数内部通过<code>env</code>判断当前所处的模式，再写入到<code>mode</code>配置项中</li></ul><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// package.json的scripts命令配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webpack --env.NODE_ENV=development&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;build&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webpack --env.NODE_ENV=production&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(80, 250, 123)">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> isDevelopment </span><span class="token operator">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;development&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> isProduction </span><span class="token operator">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;production&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token plain"> isProduction </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;production&quot;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> isDevelopment </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;development&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="wds">WDS<a class="hash-link" href="#wds" title="标题的直接链接">​</a></h2><blockquote><p><a href="https://webpack.docschina.org/guides/development/#using-webpack-dev-server" target="_blank" rel="noopener noreferrer">使用 webpack-dev-server</a></p></blockquote><p>WDS，webpack-dev-server，webpack 开发服务器。根据 webpack 的介绍，webpack-dev-server 可以在本地开启一个简单的 web 服务器，并且具有 live reloading(实时重新加载) 功能，也可以使用 webpack 的观察模式来做到文件修改自动构建，但是观察模式无法在浏览器中自动刷新页面，为了看到修改后的实际效果，需要手动刷新浏览器。</p><p>webpack-dev-server 能做到自动打包文件，并且自动刷新浏览器页面。</p><p>首先安装 webpack-dev-server</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> webpack-dev-server -D</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在<code>webpack.config.js</code>中简单配置启用 webpack-dev-server</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">devServer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">open</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">9999</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">compress</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">writeToDisk</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同时修改 npm-scripts 中的<code>start</code>配置</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webpack-dev-server --env.NODE_ENV=development&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来就可以执行<code>yarn start</code>命令查看 webpack-dev-server 的效果了。</p><p><img loading="lazy" alt="devserver-test" src="/assets/images/devserver-test-1598434408604-46b7da769f684148b15d421df7a54c80.gif" width="1907" height="1002" class="img_ev3q"></p><p>接下来测试一下修改自动刷新页面</p><p><img loading="lazy" alt="devserver-test2" src="/assets/images/devserver-test2-1073d2066eae39290590c578458e141b.gif" width="1907" height="1010" class="img_ev3q"></p><p>关于 webpack-dev-server 的详细配置项还有很多，需要注意的是，部分配置项带见<code>CLI only</code> 的表示该配置项只能用在命令行中，不能在<code>webpack.config.js</code>使用，见 —— <a href="https://webpack.docschina.org/configuration/dev-server/" target="_blank" rel="noopener noreferrer">配置 - DevServer</a>。</p><table><thead><tr><th>配置项</th><th>值类型</th><th>default</th><th>含义</th></tr></thead><tbody><tr><td><code>port</code></td><td><code>number</code></td><td>8000</td><td>域名端口号</td></tr><tr><td><code>compress</code></td><td><code>boolean</code></td><td>false</td><td>为每个静态文件开启 gzip 压缩</td></tr><tr><td><code>https</code></td><td><code>boolean</code></td><td>false</td><td>启用 https，如果开启 https 需要自定义的证书，否则浏览器会报错</td></tr><tr><td><code>open</code></td><td><code>boolean</code></td><td>false</td><td>告诉 dev-server 在服务器启动后在系统默认浏览器中显示页面</td></tr><tr><td><code>openPage</code></td><td><code>string</code></td><td><code>index.html</code></td><td>指定打开浏览器要浏览的页面，默认是根目录的<code>index.html</code></td></tr><tr><td><code>proxy</code></td><td><code>object</code></td><td>null</td><td>这个配置那是相当有用，直接用途可以不通过服务端解决开发环境的跨域请求问题，文档见 —— <a href="https://github.com/chimurai/http-proxy-middleware" target="_blank" rel="noopener noreferrer">http-proxy-middleware</a></td></tr><tr><td><code>contentBase</code></td><td><code>boolean</code></td><td><code>false</code></td><td>指定提供给 devServer 的静态文件的路径</td></tr><tr><td><code>watchContentBase</code></td><td><code>boolean</code></td><td>false</td><td>监听 <!-- -->[<code>devServer.contentBase</code>]<!-- -->选项提供的静态文件，启用后，文件更改将触发整个页面重新加载</td></tr><tr><td><code>writeToDisk</code></td><td><code>boolean</code></td><td>false</td><td>告诉 <code>devServer</code> 将自动打包的文件写入硬盘，写入的文件目录路径为<code>webpack.config.js</code>中配置的<code>output.path</code></td></tr><tr><td><code>stats</code></td><td><code>string</code></td><td></td><td>采用<a href="https://webpack.docschina.org/configuration/stats/" target="_blank" rel="noopener noreferrer">stats 对象</a>，控制在控制台中显示哪些信息，例如<code>&#x27;errors-only&#x27;</code>只在发生错误或有新的编译时输出；<br>与下面的<code>noInfo</code>或<code>quiet</code>一起使用时，该选项无效。</td></tr><tr><td><code>overlay</code></td><td><code>object</code></td><td>false</td><td>出现编译器错误或警告时，在浏览器中全屏显示出来</td></tr><tr><td><code>noInfo</code></td><td><code>boolean</code></td><td>false</td><td>在终端隐藏 webpack 打包过程等信息，只在出错或者警告的时候才显示这些信息</td></tr><tr><td><code>quiet</code></td><td><code>boolean</code></td><td>false</td><td>在终端隐藏 webpack 的错误或警告等信息，只在控制台显示初始启动信息</td></tr><tr><td><code>liveReload</code></td><td><code>boolean</code></td><td>true</td><td>热重载，默认情况下，检测到文件更改时，devser 就将重新编译打包，然后刷新页面；如果启动 HMR，这个选项会被自动禁用</td></tr><tr><td><code>inline</code></td><td><code>boolean</code></td><td>true</td><td><code>inline</code>模式会自动刷新页面，并且构建消息将出现在浏览器控制台中，如果设置为<code>false</code>，那么页面内容将放在一个<code>iframe</code>里调试，并且页面顶部会出现一个调试进度条，当组件更新时，看不到页面刷新的过程</td></tr><tr><td><code>hot</code></td><td><code>boolean</code></td><td>false</td><td>启用 HMR</td></tr><tr><td><code>hotOnly</code></td><td><code>boolean</code></td><td>false</td><td><code>hotOnly</code>将作为构建失败时的回退；如果将<code>hotOnly</code>设置为<code>true</code>，那么组件更新以后，浏览器不会自动刷新</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hmr">HMR<a class="hash-link" href="#hmr" title="标题的直接链接">​</a></h2><blockquote><p><a href="https://webpack.docschina.org/concepts/hot-module-replacement/" target="_blank" rel="noopener noreferrer">概念 - HMR</a></p></blockquote><p>webpack-dev-server 默认情况下，会开启热重载<code>liveReload</code>功能，检测到文件更改时，devser 就将重新编译打包，然后刷新页面；</p><p><img loading="lazy" alt="image-20200826173913328" src="/assets/images/image-20200826173913328-0988776d67d3cdea10a4c6bd13999f10.png" width="529" height="378" class="img_ev3q"></p><p>对于代码量小的项目，重新编译的时间损耗不会太多，但是项目需要使用的组件，模块等越来越多，打包过程也会越来越慢，会越来越影响开发效率。</p><p>HMR，hot module replacement，模块热替换，是 webpack 提供的在本地开发环境的程序运行过程中，替换，添加和删除模块代码以后，无需重新加载整个页面，便能完成页面更新的功能。同时，当前页面的状态也能保存下来。</p><p>使用 HMR，无需安装额外的插件，只需要在 devserver 的配置项中启用<code>hot:true</code>即可，当设置<code>hot:true</code>时，将自动添加<code>HotModuleReplacementPlugin</code>这个插件，无需其他配置。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">devServer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">hot</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>成功启用 HMR 以后，浏览器的 devtool 一般会输出 HMR 的信息，例如</p><p><img loading="lazy" alt="image-20200826181804190" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA5oAAAA5CAYAAABXlVRWAAAWFElEQVR4nO3dfWwTZ54H8C8tmdhx4tgxSSAkJOsmgbAYSFqnC2YhWYgXlqtFFQRJVymV0t0eW51uJXRbadFK1V13Jbqq1NNq+6IDadvqCu011yott91QxMteqCCFQLJNgIAv3kDIC47z5thxirg/3BnGr3FiJ3bo9/MXsWc8zzzPGM3Pv9/zzKLHH3/8PiiATqeLdxPoO8Jut8e7CSENjbrj3QRKUBlqRbybQERERAnskXg3IFHdu3cv3k2g74BEv84efWRRvJtACYjXBREREU2HgWYITqcz4YMAWtju3bsHp9MZ72aElaJIYlBBPh59ZBFSFEnxbgYREREluMXxbkCimpqawvDwcLybQRRXSYsfQXpqcrybQUREREQLDDOaREREREREFFMMNImIiIiIiCimGGgSERERERFRTDHQJCIiIiIiophaPDIyEu82EBERERER0UOEGU0iIiIiIiKKKQaaREREREREFFMMNImIiIiIiCimGGgSERERERFRTDHQJCIiIiIiophaHI+DVtfWo0BfDAAYHLiDD997G263a06Pma8vgqX6WQiCAI/Hg8aGd2Gzds3pMUWVZgvKjCY0HW9A++ULM9q3urYeObkF89peADCsL4d5ZzUAzHt/RSNfX4Rt259Gw9EjGHbY492ckDRaHWr27ceEc3xern/A93t3qaUZp5oaZ7S/QqHEnroXkJm1DADQbb2OhqNHYt5OIiIiIlqYVu39NbLLfgwgToEmEHijK97E9tis0uvy1+4O9MG8s1oK1sT3AODD997Ghs1VKDOapM9zOsdw7J03pWDDZu3CH37/G2i0OlTX1kfUxlBBS76+CBs2bcMnH/4pqgBBPIfWlnMzDkDnkkarg6nCPKvAeKExrC9HqXHjvAV78SQGhZFe//42bK4CAPzxtZfj2lehvjcKhRK79jyHvjs9eLz8hz77+P9/I/74I5qvH7yIiIiIHmZXP/gdrn7wO6za++v4BZoztSRrKUaGh7AkaykAIDsnF4KQjPGxUWkbeYalurYelt11Ud88CkIy0rUZUWXHTjU1zjh7JIpHxihdm4Epjwc9tpvzfuzvimGHHW+9/kq8mzEjGbpM9NisCROMif8XBCP/oUmsZgC830XD+nKsXL0WR954NaGz3kRE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" width="922" height="57" class="img_ev3q"></p><p>对 React 来说，在 HMR 里做的是重新引入 root component，然后重新渲染。因为 HMR 是对 root component 的热替换，所以替换之后 root component 和它内部的 component 的 state 都会丢失，但是对于保存在像 Redux store 等外部数据容器中的状态则可以保持。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-fast-refresh">React Fast Refresh<a class="hash-link" href="#react-fast-refresh" title="标题的直接链接">​</a></h2><p>社区过去一直使用<a href="https://github.com/gaearon/react-hot-loader#react-hot-loader" target="_blank" rel="noopener noreferrer">React Hot Loader</a>作为热更新 React 组件的方案，但是 19 年的时候，React 团队将 React Native 的 fast refresh 功能移植出来，支持在 web 开发中使用。</p><p>对于<strong>React Fast Refresh</strong>，目前没有正式的介绍文档，其相关概念只存在于 GitHub 的 issue 讨论中 —— <a href="https://github.com/facebook/react/issues/16604#issuecomment-528663101" target="_blank" rel="noopener noreferrer">What Is Fast Refresh?</a></p><p>目前，社区已经有了支持 React Fast Refresh 的 webpack 插件 —— <a href="https://github.com/pmmmwh/react-refresh-webpack-plugin/#react-refresh-webpack-plugin" target="_blank" rel="noopener noreferrer">React Refresh Webpack Plugin</a></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> @pmmmwh/react-refresh-webpack-plugin react-refresh -D</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 React Fast Refresh，需要在<code>webpack.config.js</code>中配置两步：</p><ul><li>启用引入 ReactRefreshWebpackPlugin；</li><li>在<code>babel-loader</code>中启用<code>react-refresh/babel</code>这个 plugin；</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// 引入ReactRefreshWebpackPlugin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token maybe-class-name">ReactRefreshWebpackPlugin</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@pmmmwh/react-refresh-webpack-plugin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(80, 250, 123)">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> isDevelopment </span><span class="token operator">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">NODE_ENV</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;development&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      isDevelopment </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ReactRefreshWebpackPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token known-class-name class-name">Boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.m?jsx?$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(node_modules)</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token literal-property property">use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;babel-loader&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                isDevelopment </span><span class="token operator">&amp;&amp;</span><span class="token plain"> require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;react-refresh/babel&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token known-class-name class-name">Boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里<code>filter(Boolean)</code>是一个小技巧，<code>Array</code>的<code>filter(callback)</code>方法本身是删除掉数组中不满足条件的元素，也就是它只会把调用<code>callback</code>返回<code>true</code>的元素放入到新生成的数组中；当构造函数<code>Boolean</code>作为回调函数的时候，对传入<code>Boolean</code>只有在<strong>非</strong><code>false</code>，<code>undefined</code>，<code>NaN</code>，<code>0</code>，空字符串<code>“”</code>的时候才会返回<code>true</code>。</p><p>使用<code>&amp;&amp;</code>语法的时候，那些不会在当前环境中使用的 plugin 或者 loader，它们也会返回<code>false</code>，有时候这种情况是会报错的，于是就使用<code>filter(Boolean)</code>过滤掉那些在当前环境中不使用的 plugin 或者 loader 了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="source-map">source map<a class="hash-link" href="#source-map" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是-source-map">什么是 source map<a class="hash-link" href="#什么是-source-map" title="标题的直接链接">​</a></h3><p>最初的 JS 代码都会经过<a href="https://zh.wikipedia.org/wiki/%E6%A5%B5%E7%B0%A1%E5%8C%96" target="_blank" rel="noopener noreferrer">压缩（minify）</a>操作，来移除代码中非必要性的空格，注释，换行符等内容，以减小代码体积。因为 JS 是嵌入在 HTML 中的，需要先通过网络获取才能解析执行，减小代码体积有利于缩短网络请求时间，进而间接地缩短网页加载的时间。</p><p>后来又出现了<a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86" target="_blank" rel="noopener noreferrer">代码混淆</a>技术，通过将代码中的各种元素，如变量、函数、类的名字改写成无意义的名字，来提升 JS 在客户端的安全性。</p><p>这些操作虽然有利于提升客户端体验，但是不利于开发人员调试，于是就出现了 source map 这项技术，将源代码和压缩后的代码对应起来，通过开启 source map 就能很好的找到映射的源代码，从而方便调试。</p><p>source map 本质上就是一个以<code>.map</code>为后缀名的 JSON 文件，里面写入了一些源文件和压缩文件的映射关系属性，例如</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;file&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;script.js.map&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//source map文件名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;sources&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">//源文件名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;app.js&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;content.js&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;widget.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;sourceRoot&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//源文件路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;names&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;slideUp&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;slideDown&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;save&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//包含源文件中所有变量和函数名称的数组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;AAA0B,kBAAhBA,QAAOC,SACjBD,OAAOC,OAAO...&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据 source map 文件，在压缩后的代码文件底部通过一个注释字段<code>sourceMappingURL</code>写入 source map 文件的路径，告知浏览器我这个压缩文件有一个源代码文件映射可以用，例如</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">//# sourceMappingURL=/path/to/script.js.map</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>后来，在 JS 基础上衍生出来的语言，例如 JSX，TS，CoffeeScript 等也都能通过这样技术映射出来。一些浏览器也都内置了对 source map 的支持，例如 Chrome 可以在 devtool 的设置面板中开启 JS 和 CSS 的 source map。</p><p><img loading="lazy" alt="image-20200827162309877" src="/assets/images/image-20200827162309877-3c725de3359b6b3d16fdb47a2fc744f9.png" width="930" height="821" class="img_ev3q"></p><p>如果用了 WDS，是不需要使用 source map 的，因为开发环境的 WDS 有直观的错误提示，尤其在 React 中配合<strong>React Fast Refresh</strong>使用更加强大，可以在页面测试一下，给定以下代码：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">/*当输入的时候直接报错*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">handleChange</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;测试&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">render</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">input</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(255, 121, 198)">state</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(255, 121, 198)">value</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">onChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(255, 121, 198)">handleChange</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当输入出错的时候，浏览器页面立即弹出了如下的错误提示框</p><p><img loading="lazy" alt="image-20200827173532380" src="/assets/images/image-20200827173532380-8a7a799f8fcd9af45eca22f39faa81c6.png" width="1243" height="745" class="img_ev3q"></p><p>但是，source map 在生产环境中仍然有使用的必要性，对于上面的错误测试代码，当我们执行<code>yarn build</code>打包代码以后，生成的目录如下：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">dist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─ favicon.ico</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─ index.html</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─ main.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在浏览器中打开 html 页面，输入之后立刻就会报错，从 devtool 可以获知报错信息如下：</p><p><img loading="lazy" alt="image-20200827174154265" src="/assets/images/image-20200827174154265-82ca24b4f3780ffd15dbbfc8375c6187.png" width="1229" height="666" class="img_ev3q"></p><p>可以看到这样的报错信息指向的代码位置已经糊成一团了，如果是复杂的错误，这种代码错误定位屁用没有。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="devtool">devtool<a class="hash-link" href="#devtool" title="标题的直接链接">​</a></h3><p>要在 webpack 中开启 source map，只需要一个配置项<code>devtool</code>，可以传入指定的模式字符串，或者使用<code>devtool:false</code>禁用它；如果省略<code>devtool</code>配置项，也就是不会生成 source map 文件。</p><blockquote><p><a href="https://webpack.docschina.org/configuration/devtool/" target="_blank" rel="noopener noreferrer">Devtool</a></p><p><a href="https://juejin.im/post/6844903450644316174#heading-4" target="_blank" rel="noopener noreferrer">参考 —— devtool 里的 7 种 SourceMap 模式</a></p></blockquote><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token plain"> isProduction </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;source-map&quot;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>推荐在生产环境下使用<code>devtool: &quot;source-map&quot;</code>，执行<code>yarn build</code>重新打包一下，看到目录下多了一个<code>.map</code>文件</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">dist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─ favicon.ico</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─ index.html</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─ main.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─ main.js.map</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时候打开 html 页面测试输入报错，可以看到已经成功定位到了源代码的错误点，OK！</p><p><img loading="lazy" alt="image-20200827175357789" src="/assets/images/image-20200827175357789-ff11bd14a1b37e873b601275f708f80a.png" width="917" height="603" class="img_ev3q"></p><p>除了 webpack 自带的输出 source map 文件的功能，一些 loader 也会提供生成 source map 的配置选项，不过它们最终都依赖于<code>devtool</code>配置项是否启用，例如<code>css-loader</code>提供<code>sourceMap</code>的配置项，可以为 CSS 文件生成 source map。</p><p>不过需要注意的是，生产环境如果配置<code>devtool</code>选项，依据不同的<code>devtool</code>，对构建速度的影响也不同，一般来说：</p><ul><li>指定<code>devtool:source-map</code>可以详细追踪到错误信息的位置，但是出现错误可以在 devtool 中直接跟踪到源码，例如上图</li><li>指定<code>devtool:eval</code>可以显示错误位置，但是代码会是经过 babel 等编译过的代码，如果是 React 组件，大致也能分析出错误的代码位置</li></ul><p><img loading="lazy" alt="image-20200910142210278" src="/assets/images/image-20200910142210278-b723489aac3b8cad46cc7357dde590d5.png" width="762" height="635" class="img_ev3q"></p><ul><li><p>指定<code>devtool:eval-cheap-source-map</code>和<code>devtool:eval</code>看起来差不多，依旧是编译过的代码</p></li><li><p>指定<code>devtool:eval-cheap-module-source-map</code>也能显示具体的源码位置，不过相对于<code>devtool:source-map</code>构建速度会大幅减少，webpack 是推荐使用这个配置项</p></li><li><p>指定<code>devtool:eval-source-map</code>，<code>eval-nosources-source-map</code>，<code>eval-nosources-cheap-source-map</code>，<code>eval-nosources-cheap-module-source-map</code>也都能显示源码位置</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注意点">注意点<a class="hash-link" href="#注意点" title="标题的直接链接">​</a></h3><p>如果在 webpack 的配置项<code>optimization.minimizer</code>中自定义<code>terser-webpack-plugin</code>的相关配置，哪怕只写了一个初始化<code>terser-webpack-plugin</code>的实例，也会对 webpack 开发环境生成的 source map 造成影响，所以必须保证开启<code>terser-webpack-plugin</code>的<code>sourceMap</code>配置项，如果这个没配置，<code>devtool</code>也没指定，那么开发环境的代码映射就会直接映射到打包生成的 chunk 下，并不会映射到源代码。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token maybe-class-name">TerserPlugin</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;terser-webpack-plugin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//压缩JS代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">minimizer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">TerserPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">sourceMap</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wood3n/icodex-next/tree/master/docs/engineer/基于webpack搭建react项目/搭建React项目（2）.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（1）"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">搭建 React 项目（1）</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（3）"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">搭建 React 项目（3）</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#开发模式" class="table-of-contents__link toc-highlight">开发模式</a><ul><li><a href="#development" class="table-of-contents__link toc-highlight">development</a></li><li><a href="#production" class="table-of-contents__link toc-highlight">production</a></li><li><a href="#针对不同模式的配置" class="table-of-contents__link toc-highlight">针对不同模式的配置</a></li><li><a href="#不同模式的切换" class="table-of-contents__link toc-highlight">不同模式的切换</a></li></ul></li><li><a href="#wds" class="table-of-contents__link toc-highlight">WDS</a></li><li><a href="#hmr" class="table-of-contents__link toc-highlight">HMR</a></li><li><a href="#react-fast-refresh" class="table-of-contents__link toc-highlight">React Fast Refresh</a></li><li><a href="#source-map" class="table-of-contents__link toc-highlight">source map</a><ul><li><a href="#什么是-source-map" class="table-of-contents__link toc-highlight">什么是 source map</a></li><li><a href="#devtool" class="table-of-contents__link toc-highlight">devtool</a></li><li><a href="#注意点" class="table-of-contents__link toc-highlight">注意点</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.37c10f68.js"></script>
<script src="/assets/js/main.777d231b.js"></script>
</body>
</html>