"use strict";(self.webpackChunkicodex_next=self.webpackChunkicodex_next||[]).push([[2546],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return h}});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(t),h=r,d=m["".concat(s,".").concat(h)]||m[h]||c[h]||o;return t?a.createElement(d,i(i({ref:n},u),{},{components:t})):a.createElement(d,i({ref:n},u))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},56810:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return c}});var a=t(83117),r=t(80102),o=(t(67294),t(3905)),i=["components"],l={},s=void 0,p={unversionedId:"react/router/router6",id:"react/router/router6",title:"router6",description:"react-router-dom v6",source:"@site/docs/react/router/router6.md",sourceDirName:"react/router",slug:"/react/router/router6",permalink:"/docs/react/router/router6",draft:!1,editUrl:"https://github.com/wood3n/icodex-next/tree/master/docs/react/router/router6.md",tags:[],version:"current",frontMatter:{},sidebar:"react",previous:{title:"react\u6309\u9700\u52a0\u8f7d",permalink:"/docs/react/router/react\u6309\u9700\u52a0\u8f7d"}},u={},c=[{value:"react-router-dom v6",id:"react-router-dom-v6",level:2},{value:"JSX \u7ec4\u4ef6",id:"jsx-\u7ec4\u4ef6",level:2},{value:"BrowserRouter",id:"browserrouter",level:3},{value:"HashRouter",id:"hashrouter",level:3},{value:"Routes \u548c Route",id:"routes-\u548c-route",level:3},{value:"Outlet",id:"outlet",level:3},{value:"Navigate",id:"navigate",level:3},{value:"NavLink",id:"navlink",level:3},{value:"Hook",id:"hook",level:2},{value:"useRoutes",id:"useroutes",level:3},{value:"useNavigate",id:"usenavigate",level:3},{value:"useParams",id:"useparams",level:3},{value:"useSearchParams",id:"usesearchparams",level:3},{value:"useLocation",id:"uselocation",level:3}],m={toc:c};function h(e){var n=e.components,l=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},m,l,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"react-router-dom-v6"},"react-router-dom v6"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"react-router"),"\u65e9\u524d\u53d1\u5e03\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"v6"),"\u7248\u672c\uff0c\u6539\u52a8\u4e86\u8bb8\u591a\u5185\u5bb9\uff0c\u73b0\u5728\u7684 API \u771f\u7684\u597d\u7528\u633a\u591a\u7684\u3002\u8bdd\u4e0d\u591a\u8bf4\uff0c\u76f4\u63a5\u770b API\u3002"),(0,o.kt)("h2",{id:"jsx-\u7ec4\u4ef6"},"JSX \u7ec4\u4ef6"),(0,o.kt)("h3",{id:"browserrouter"},"BrowserRouter"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"BrowserRouter"),"\u7b80\u5316\u4e86\u5c5e\u6027\u914d\u7f6e\uff0c\u589e\u52a0\u4e86\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"p"},"window"),"\u5c5e\u6027\uff0c\u5173\u8054\u5f53\u524d DOM \u6240\u5728\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"window"),"\u5bf9\u8c61\uff0c\u53ef\u4ee5\u7528\u6765\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"iframe"),"\u4e4b\u95f4\u4ea4\u4e92\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"declare function BrowserRouter(\n  props: BrowserRouterProps\n): React.ReactElement;\n\ninterface BrowserRouterProps {\n  basename?: string;\n  children?: React.ReactNode;\n  window?: Window;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"BrowserRouter"),"\u7684\u6e90\u7801\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\u7ec4\u4ef6\uff0c\u8fd4\u56de\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"Router"),"\u7ec4\u4ef6\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"export function BrowserRouter({\n  basename,\n  children,\n  window,\n}: BrowserRouterProps) {\n  let historyRef = React.useRef<BrowserHistory>();\n  if (historyRef.current == null) {\n    historyRef.current = createBrowserHistory({ window });\n  }\n\n  let history = historyRef.current;\n  let [state, setState] = React.useState({\n    action: history.action,\n    location: history.location,\n  });\n\n  React.useLayoutEffect(() => history.listen(setState), [history]);\n\n  return (\n    <Router\n      basename={basename}\n      children={children}\n      location={state.location}\n      navigationType={state.action}\n      navigator={history}\n    />\n  );\n}\n")),(0,o.kt)("p",null,"\u9996\u5148\u4f7f\u7528",(0,o.kt)("a",{parentName:"p",href:"https://github.com/remix-run/history"},(0,o.kt)("inlineCode",{parentName:"a"},"history")),"\u5e93\u63d0\u4f9b\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"createBrowserHistory"),"\u51fd\u6570\u521b\u5efa",(0,o.kt)("inlineCode",{parentName:"p"},"history"),"\u5bf9\u8c61\uff0c\u7136\u540e\u5305\u88c5\u6210",(0,o.kt)("inlineCode",{parentName:"p"},"state"),"\u4f20\u9012\u7ed9",(0,o.kt)("inlineCode",{parentName:"p"},"Router"),"\u7ec4\u4ef6\u3002"),(0,o.kt)("p",null,"\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0b",(0,o.kt)("inlineCode",{parentName:"p"},"history"),"\u8fd9\u4e2a\u5e93\uff0c\u5176\u5bf9 HTML5 \u7684",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/History"},(0,o.kt)("inlineCode",{parentName:"a"},"history")," API")," \u505a\u4e86\u4e00\u5c42\u5c01\u88c5\uff0cHTML5 \u7684",(0,o.kt)("inlineCode",{parentName:"p"},"history")," API \u672c\u8eab\u5728\u6d4f\u89c8\u5668\u65b9\u9762\u6709\u7740\u975e\u5e38\u597d\u7684\u517c\u5bb9\u6027\uff0c\u652f\u6301 IE10\uff0c\u4f46\u662f\u5176\u63d0\u4f9b\u7684\u65b9\u6cd5\u4e0d\u662f\u592a\u5229\u4e8e\u65e5\u5e38\u5f00\u53d1\uff0c(\u4f8b\u5982\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"history.push"),"\u5176\u5b9e\u662f\u6ca1\u6709\u7684\uff0c\u53ea\u6709",(0,o.kt)("inlineCode",{parentName:"p"},"history.pushState"),"\u8fd9\u6837\u7e41\u7410\u7684\u65b9\u6cd5)\uff0c\u6240\u4ee5\u5728\u5176\u57fa\u7840\u4e4b\u4e0a\u505a\u4e00\u5c42\u5c01\u88c5\u5904\u7406\uff0c\u66f4\u5229\u4e8e\u65e5\u5e38\u5f00\u53d1\u4f7f\u7528\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"history.listen"),"\u65b9\u6cd5\u4f1a\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"history"),"\u5bf9\u8c61\u5185\u90e8\u7ef4\u62a4\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u961f\u5217\uff0c\u5f53\u7ec4\u4ef6\u5185\u90e8\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"history.push"),"\u7b49\u65b9\u6cd5\u540e\uff0c\u901a\u8fc7\u4f20\u9012\u5f53\u524d\u64cd\u4f5c\u7c7b\u578b",(0,o.kt)("inlineCode",{parentName:"p"},"action"),"\u548c\u5f53\u524d",(0,o.kt)("inlineCode",{parentName:"p"},"location"),"\u5bf9\u8c61\u4f9d\u6b21\u8c03\u7528\u961f\u5217\u5185\u7684\u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u91cc\u4e5f\u5c31\u662f\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"setState"),"\u6765\u5237\u65b0\u9876\u5c42",(0,o.kt)("inlineCode",{parentName:"p"},"BrowserRouter"),"\u5185\u90e8\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"location"),"\u5bf9\u8c61\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'const readOnly: <T>(obj: T) => Readonly<T> = __DEV__\n  ? (obj) => Object.freeze(obj)\n  : (obj) => obj;\n\n// \u62fc\u63a5 url\nfunction createPath({\n  pathname = "/",\n  search = "",\n  hash = "",\n}: Partial<Path>) {\n  if (search && search !== "?")\n    pathname += search.charAt(0) === "?" ? search : "?" + search;\n  if (hash && hash !== "#")\n    pathname += hash.charAt(0) === "#" ? hash : "#" + hash;\n  return pathname;\n}\n\n// \u521b\u5efa\u56de\u8c03\u51fd\u6570\u961f\u5217\nfunction createEvents<F extends Function>(): Events<F> {\n  let handlers: F[] = [];\n\n  return {\n    get length() {\n      return handlers.length;\n    },\n    push(fn: F) {\n      handlers.push(fn);\n      return function () {\n        handlers = handlers.filter((handler) => handler !== fn);\n      };\n    },\n    call(arg) {\n      handlers.forEach((fn) => fn && fn(arg));\n    },\n  };\n}\n\nfunction createBrowserHistory(\n    options: BrowserHistoryOptions = {}\n): BrowserHistory {\n  // \u539f\u751f history \u5bf9\u8c61\n  let globalHistory = window.history;\n  // \u6267\u884c\u8df3\u8f6c history.pushState \u4ee5\u540e\u7684\u56de\u8c03\u51fd\u6570\u961f\u5217\n  let listeners = createEvents<Listener>();\n  let [index, location] = getIndexAndLocation();\n\n  // \u83b7\u53d6\u5f53\u524d location \u5bf9\u8c61\n  function getIndexAndLocation(): [number, Location] {\n    let { pathname, search, hash } = window.location;\n    let state = globalHistory.state || {};\n    return [\n      state.idx,\n      readOnly<Location>({\n        pathname,\n        search,\n        hash,\n        state: state.usr || null,\n        key: state.key || "default",\n      }),\n    ];\n  }\n  \n  // \u521b\u5efa\u8df3\u8f6c\u76ee\u6807\u7684location\u5bf9\u8c61\n  function getNextLocation(to: To, state: any = null): Location {\n    return readOnly<Location>({\n      pathname: location.pathname,\n      hash: "",\n      search: "",\n      ...(typeof to === "string" ? parsePath(to) : to),\n      state,\n      key: createKey(),\n    });\n  }\n  \n  // \u5728\u8df3\u8f6c\u5b8c\u6210\u4ee5\u540e\u4f9d\u6b21\u8c03\u7528 listeners\n  function applyTx(nextAction: Action) {\n    action = nextAction;\n    [index, location] = getIndexAndLocation();\n    listeners.call({ action, location });\n  }\n  \n  // \u521b\u5efa\u5957\u8f6c\u76ee\u6807\u7684 state \u5bf9\u8c61\n  function getHistoryStateAndUrl(\n    nextLocation: Location,\n    index: number\n  ): [HistoryState, string] {\n    return [\n      {\n        usr: nextLocation.state,\n        key: nextLocation.key,\n        idx: index,\n      },\n      createHref(nextLocation),\n    ];\n  }\n  \n  // \u83b7\u53d6\u76ee\u6807 url\n  function createHref(to: To) {\n    return typeof to === "string" ? to : createPath(to);\n  }\n    \n  function push() {\n    let nextLocation = getNextLocation(to, state);\n    let [historyState, url] = getHistoryStateAndUrl(nextLocation, index + 1);\n    // \u8c03\u7528 history.pushState \u8df3\u8f6c\n    globalHistory.pushState(historyState, "", url);\n    ...\n    applyTx(nextAction);\n  }\n    \n  let history = {\n    get action() {\n      return action;\n    },\n    get location() {\n      return location;\n    },\n        push,\n    replace,\n    go,\n    back() {\n      go(-1);\n    },\n    forward() {\n      go(1);\n    },\n    listen(listener) {\n      return listeners.push(listener);\n    },\n    ...\n  };\n    \n  return history;\n}\n')),(0,o.kt)("p",null,"\u4ece react-devtool \u5728\u6d4f\u89c8\u5668\u89c2\u5bdf\u53ef\u4ee5\u770b\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"Router"),"\u63a5\u53d7\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"props"),"\u5927\u81f4\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20220313150533341",src:t(3373).Z,width:"731",height:"524"})),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Router"),"\u7ec4\u4ef6\u662f\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"p"},"Context.Provider"),"\uff0c\u5176\u5185\u90e8\u5bf9",(0,o.kt)("inlineCode",{parentName:"p"},"history"),"\u7b49\u5bf9\u8c61\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo"),"\u505a\u4e86\u4e00\u5c42\u7f13\u5b58\u5904\u7406\uff0c\u7136\u540e\u901a\u8fc7",(0,o.kt)("inlineCode",{parentName:"p"},"Context"),"\u7684\u539f\u7406\uff0c\u5411\u4e0b\u900f\u4f20",(0,o.kt)("inlineCode",{parentName:"p"},"history"),"\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"location"),"\u7b49\u5bf9\u8c61\u3002\u8fd9\u6837\uff0c\u5f53",(0,o.kt)("inlineCode",{parentName:"p"},"history")," \u5bf9\u8c61\u66f4\u65b0\u540e\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"Router"),"\u7ec4\u4ef6\u5c31\u4f1a\u66f4\u65b0\u5176\u6240\u6709\u5b50\u7ec4\u4ef6\u5185\u90e8\u7684\u72b6\u6001\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'// \u5411\u4e0b\u900f\u4f20 basename\uff0chistory \u5bf9\u8c61\nconst NavigationContext = React.createContext<NavigationContextObject>(null!);\n\n// \u5411\u4e0b\u900f\u4f20 location \u5bf9\u8c61\nconst LocationContext = React.createContext<LocationContextObject>(null!);\n\nfunction Router({\n  basename: basenameProp = "/",\n  children = null,\n  location: locationProp,\n  navigationType = NavigationType.Pop,\n  navigator,\n  static: staticProp = false,\n}: RouterProps): React.ReactElement | null {\n  let navigationContext = React.useMemo(\n    () => ({ basename, navigator, static: staticProp }),\n    [basename, navigator, staticProp]\n  );\n  \n  let location = React.useMemo(() => {\n    let trailingPathname = stripBasename(pathname, basename);\n\n    if (trailingPathname == null) {\n      return null;\n    }\n\n    return {\n      pathname: trailingPathname,\n      search,\n      hash,\n      state,\n      key,\n    };\n  }, [basename, pathname, search, hash, state, key]);\n  \n  return (\n    <NavigationContext.Provider value={navigationContext}>\n      <LocationContext.Provider\n        children={children}\n        value={{ location, navigationType }}\n      />\n    </NavigationContext.Provider>\n  )\n}\n')),(0,o.kt)("p",null,"\u65e2\u7136\u6709",(0,o.kt)("inlineCode",{parentName:"p"},"Context.Provider"),"\uff0c\u80af\u5b9a\u4e5f\u6709\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"useContext"),"\u7684\u5730\u65b9\uff0c\u7ee7\u7eed\u770b\u4e0b\u9762\u7684 API\u3002"),(0,o.kt)("h3",{id:"hashrouter"},"HashRouter"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"HashRouter"),"\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"BrowserRouter"),"\u8fd9\u5757\u6700\u4e3b\u8981\u7684\u533a\u522b\u5c31\u662f\u5728\u8df3\u8f6c url \u7684\u5904\u7406\u4e0a\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"HashRouter"),"\u4f1a\u628a\u76ee\u6807\u8def\u5f84\u4e32\u63a5\u5728 URL \u7684",(0,o.kt)("inlineCode",{parentName:"p"},"hash"),"\u90e8\u5206\uff0c\u800c",(0,o.kt)("inlineCode",{parentName:"p"},"BrowserRouter"),"\u662f\u76f4\u63a5\u66ff\u6362\u5f53\u524d",(0,o.kt)("inlineCode",{parentName:"p"},"pathname"),"\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// BrowserRouter\nfunction createHref(to: To) {\n  return typeof to === "string" ? to : createPath(to);\n}\n\n// HashRouter\nfunction createHref(to: To) {\n  return getBaseHref() + "#" + (typeof to === "string" ? to : createPath(to));\n}\n')),(0,o.kt)("h3",{id:"routes-\u548c-route"},"Routes \u548c Route"),(0,o.kt)("p",null,"\u65b0\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"Routes"),"\u7ec4\u4ef6\u53d6\u4ee3\u4e86\u4ee5\u524d\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"Switch"),"\u7ec4\u4ef6\uff0c\u4e0d\u8fc7\u4f9d\u65e7\u662f\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7ec4\u5408\u4f7f\u7528\uff0c\u5176\u7c7b\u578b\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"declare function Routes(\n  props: RoutesProps\n): React.ReactElement | null;\n\ninterface RoutesProps {\n  children?: React.ReactNode;\n  location?: Partial<Location> | string;\n}\n\ndeclare function Route(\n  props: RouteProps\n): React.ReactElement | null;\n\ninterface RouteProps {\n  caseSensitive?: boolean;\n  children?: React.ReactNode;\n  // \u7ec4\u4ef6\n  element?: React.ReactNode | null;\n  index?: boolean;\n  // \u8def\u7531\u8def\u5f84\n  path?: string;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Routes"),"\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7ec4\u5408\u4f7f\u7528\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7528\u6765\u6839\u636e\u5305\u88f9\u9875\u9762\u6e32\u67d3\u7684\u7ec4\u4ef6\u548c\u6307\u5b9a\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"path"),"\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"Routes"),"\u7528\u6765\u6839\u636e\u5f53\u524d URL \u5339\u914d",(0,o.kt)("inlineCode",{parentName:"p"},"path"),"\u6765\u6e32\u67d3\u6307\u5b9a",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7684\u7ec4\u4ef6\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'<Routes>\n  <Route path="/" element={<Dashboard />}>\n    <Route\n      path="messages"\n      element={<DashboardMessages />}\n    />\n    <Route path="tasks" element={<DashboardTasks />} />\n  </Route>\n  <Route path="about" element={<AboutPage />} />\n</Routes>\n')),(0,o.kt)("p",null,"\u4e0b\u9762\u7814\u7a76\u4e00\u4e0b\u6e90\u7801\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u5c31\u53ea\u8d77\u5230\u5305\u88f9\u5b50\u7ec4\u4ef6\u4f20\u9012\u53c2\u6570\u7684\u76ee\u7684\uff0c\u4ee3\u7801\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u51fd\u6570\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"function Route(\n  _props: RouteProps\n): React.ReactElement | null {\n  invariant(\n    false,\n    `A <Route> is only ever to be used as the child of <Routes> element, ` +\n      `never rendered directly. Please wrap your <Route> in a <Routes>.`\n  );\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Routes"),"\u7684\u5185\u90e8\u9996\u5148\u4f1a\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"React.Children.forEach"),"\u9012\u5f52\u904d\u5386\u6240\u6709",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7ec4\u4ef6\uff0c\u5305\u62ec",(0,o.kt)("inlineCode",{parentName:"p"},"Fragment"),"\u5185\u90e8\u7684\uff0c\u62ff\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7ec4\u4ef6\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"path"),"\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"element"),"\u7b49\u5c5e\u6027\uff0c\u6700\u7ec8\u8fd4\u56de\u4e00\u4e2a\u5d4c\u5957\u7684\u6570\u7ec4\u7ed3\u6784\uff0c\u4f20\u9012\u7ed9",(0,o.kt)("inlineCode",{parentName:"p"},"useRoutes"),"\u5904\u7406\uff0c\u5c31\u8ddf\u6211\u4eec\u76f4\u63a5\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"useRoutes"),"\u4e00\u6837\u7684\u6548\u679c\uff0c\u6240\u4ee5\u8fd9\u91cc\u63a8\u8350\u76f4\u63a5\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"useRoutes"),"\uff0c\u907f\u514d\u8fd9\u4e00\u5c42\u9012\u5f52\u904d\u5386\u7684\uff0c\u63d0\u5347\u4e00\u70b9\u70b9\u6027\u80fd\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"function Routes({\n  children,\n  location,\n}: RoutesProps): React.ReactElement | null {\n  return useRoutes(createRoutesFromChildren(children), location);\n}\n\n// \u904d\u5386\u6240\u6709 Routes \u5185\u90e8\u7684 Route \u7ec4\u4ef6\uff0c\u7136\u540e\u5f97\u5230\u5d4c\u5957\u7684\u8def\u7531\u6570\u7ec4\nfunction createRoutesFromChildren(\n    children: React.ReactNode\n): RouteObject[]  {\n  let routes: RouteObject[] = [];\n\n  React.Children.forEach(children, (element) => {\n    // Fragment \u7684 \u60c5\u51b5\n    if (element.type === React.Fragment) {\n      // Transparently support React.Fragment and its children.\n      routes.push.apply(\n        routes,\n        createRoutesFromChildren(element.props.children)\n      );\n      return;\n    }\n\n    let route: RouteObject = {\n      caseSensitive: element.props.caseSensitive,\n      element: element.props.element,\n      index: element.props.index,\n      path: element.props.path,\n    };\n\n    // Route \u5d4c\u5957\u7684\u60c5\u51b5\uff0c\u7f16\u8bd1\u5b50 Route \u7ec4\u4ef6\n    if (element.props.children) {\n      route.children = createRoutesFromChildren(element.props.children);\n    }\n  });\n\n  routes.push(route);\n}\n\n// \u5f97\u5230\u7684\u6570\u636e\u7ed3\u6784\nroutes: \n[\n  {\n        caseSensitive: boolean,\n    element: React.ReactNode,\n    index: number,\n    path: string,\n    children: [\n      {\n        caseSensitive: boolean,\n        element: React.ReactNode,\n        index: number,\n        path: string\n      }\n    ]\n  }\n]\n")),(0,o.kt)("h3",{id:"outlet"},"Outlet"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"interface OutletProps {\n  context?: unknown;\n}\ndeclare function Outlet(\n  props: OutletProps\n): React.ReactElement | null;\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Outlet"),"\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"v6"),"\u65b0\u589e\u7684\u7ec4\u4ef6\uff0c\u7528\u4e8e\u6e32\u67d3\u5d4c\u5957\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u5185\u90e8\u5b50\u8def\u7531\u7ec4\u4ef6\u7684\uff0c\u4f8b\u5982\u6709\u4e00\u4e2a\u5e03\u5c40\u7ec4\u4ef6",(0,o.kt)("inlineCode",{parentName:"p"},"Layout"),"\uff0c\u5de6\u4fa7\u662f\u5bfc\u822a\u83dc\u5355\uff0c\u53f3\u4fa7\u662f\u5185\u5bb9\u5185\u5bb9\u4e3b\u4f53\u533a\u57df\uff0c\u90a3\u4e48",(0,o.kt)("inlineCode",{parentName:"p"},"Outlet"),"\u7ec4\u4ef6\u6700\u7ec8\u4f1a\u6839\u636e\u5339\u914d\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"path"),"\u66ff\u6362\u6210 ",(0,o.kt)("inlineCode",{parentName:"p"},'<Route path="/" element={<Layout />}>'),"\u4e0b\u5d4c\u5957\u7684\u5b50\u8def\u7531\u7ec4\u4ef6\uff0c\u8fd9\u5c31\u5f88\u65b9\u4fbf\u9875\u9762\u5e03\u5c40\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'function Layout() {\n  return (\n    <div style={{ display: \'flex\' }}>\n      <div style={{ flex: \'0 1 20%\' }}>\n        <ul>\n          <li>\n            <Link to="/messages">messages</Link>\n          </li>\n          <li>\n            <Link to="/tasks">tasks</Link>\n          </li>\n        </ul>\n      </div>\n      // \u4e3b\u5185\u5bb9\u533a\u57df\n      <div>\n        <Outlet />\n      </div>\n    </div>\n  )\n}\n\nfunction App() {\n  return (\n    <BrowserRouter>\n      <Routes>\n        <Route path="/" element={<Layout />}>\n          <Route path="messages" element={<div>messages</div>} />\n          <Route path="tasks" element={<div>tasks</div>} />\n        </Route>\n      </Routes>\n    </BrowserRouter>\n  )\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Outlet"),"\u5185\u90e8\u4f7f\u7528\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"useOutlet"),"\u8fd9\u4e2a hook\uff0c\u53ef\u4ee5\u770b\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"Outlet"),"\u8fd8\u53ef\u4ee5\u989d\u5916\u63a5\u6536",(0,o.kt)("inlineCode",{parentName:"p"},"Context"),"\u7684\u53c2\u6570\u900f\u4f20\u7ed9\u5d4c\u5957\u7684\u5b50\u7ec4\u4ef6\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"function Outlet(props: OutletProps): React.ReactElement | null {\n  return useOutlet(props.context);\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useOutlet"),"\u5185\u90e8\u903b\u8f91\u5f88\u7b80\u5355\uff0c\u5f97\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"RouteContext"),"\u900f\u4f20\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"outlet"),"\uff0c\u7136\u540e\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"OutletContext.Provider"),"\u5305\u88f9\u8d77\u6765\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"const OutletContext = React.createContext<unknown>(null);\n\nfunction useOutlet(context?: unknown): React.ReactElement | null {\n  let outlet = React.useContext(RouteContext).outlet;\n  if (outlet) {\n    return (\n      <OutletContext.Provider value={context}>{outlet}</OutletContext.Provider>\n    );\n  }\n  return outlet;\n}\n")),(0,o.kt)("h3",{id:"navigate"},"Navigate"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"declare function Navigate(props: NavigateProps): null;\n\ninterface NavigateProps {\n  to: To;\n  replace?: boolean;\n  state?: any;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Navigate"),"\u7ec4\u4ef6\u7528\u6765\u8fdb\u884c\u8def\u7531\u8df3\u8f6c\u64cd\u4f5c\uff0c\u5176\u5185\u90e8\u5c31\u662f\u7b80\u5355\u8c03\u7528\u4e86\u4ee5\u4e0b",(0,o.kt)("inlineCode",{parentName:"p"},"useNavigate"),"\u8fd9\u4e2a hook."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"function Navigate({ to, replace, state }: NavigateProps): null {\n  let navigate = useNavigate();\n  React.useEffect(() => {\n    navigate(to, { replace, state });\n  });\n\n  return null;\n}\n")),(0,o.kt)("p",null,"###Link"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Link"),"\u7ec4\u4ef6\u4f1a\u6e32\u67d3\u6210",(0,o.kt)("inlineCode",{parentName:"p"},"<a>"),"\u5143\u7d20\u653e\u5728\u9875\u9762\uff0c\u5176\u7c7b\u578b\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'declare function Link(props: LinkProps): React.ReactElement;\n\ninterface LinkProps\n  extends Omit<\n    React.AnchorHTMLAttributes<HTMLAnchorElement>,\n    "href"\n  > {\n  replace?: boolean;\n  state?: any;\n  to: To;\n  // \u662f\u5426\u89e6\u53d1\u6d4f\u89c8\u5668\u5237\u65b0\u52a8\u753b\n  reloadDocument?: boolean;\n}\n\ntype To = Partial<Location> | string;\n')),(0,o.kt)("h3",{id:"navlink"},"NavLink"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'declare function NavLink(\n  props: NavLinkProps\n): React.ReactElement;\n\ninterface NavLinkProps\n  extends Omit<\n    LinkProps,\n    "className" | "style" | "children"\n  > {\n  caseSensitive?: boolean;\n  children?:\n    | React.ReactNode\n    | ((props: { isActive: boolean }) => React.ReactNode);\n  className?:\n    | string\n    | ((props: {\n        isActive: boolean;\n      }) => string | undefined);\n  end?: boolean;\n  style?:\n    | React.CSSProperties\n    | ((props: {\n        isActive: boolean;\n      }) => React.CSSProperties);\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"NavLink"),"\u5185\u90e8\u4e5f\u4f7f\u7528\u4e86",(0,o.kt)("inlineCode",{parentName:"p"},"Link"),"\u7ec4\u4ef6\uff0c\u53ea\u662f\u5185\u90e8\u4f1a\u6839\u636e\u5f53\u524d\u6307\u5b9a\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"to"),"\u7684\u8def\u5f84\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"location.pathname"),"\u662f\u5426\u5339\u914d\u6765\u5224\u65ad\u662f\u5426\u4f20\u9012\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"p"},"active"),"\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"class"),"\u7ed9",(0,o.kt)("inlineCode",{parentName:"p"},"Link"),"\u7ec4\u4ef6\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7",(0,o.kt)("inlineCode",{parentName:"p"},"className"),"\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"style"),"\u51fd\u6570\u6765\u5224\u65ad\u662f\u591f\u5339\u914d\u5e76\u4f20\u9012\u6307\u5b9a\u7684\u6837\u5f0f\u3002\u5982\u679c\u6307\u5b9a",(0,o.kt)("inlineCode",{parentName:"p"},"end"),"\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5d4c\u5957\u7684\u8def\u7531\u5339\u914d\u540e\uff0c\u5176\u672c\u8eab\u4e0d\u4f1a\u88ab\u8ffd\u52a0",(0,o.kt)("inlineCode",{parentName:"p"},"active"),"\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"class"),"\u3002"),(0,o.kt)("h2",{id:"hook"},"Hook"),(0,o.kt)("h3",{id:"useroutes"},"useRoutes"),(0,o.kt)("p",null,"\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"useRoutes"),"\u914d\u7f6e\u8def\u7531\u6570\u636e\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"useRoutes"),"\u8fd4\u56de\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"routes"),"\u76f4\u63a5\u585e\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"BrowserRouter"),"\u4e0b\u5373\u53ef\u3002"),(0,o.kt)("p",null,"\u53ef\u4ee5\u907f\u514d\u4e00\u5806",(0,o.kt)("inlineCode",{parentName:"p"},"Routes"),"\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u5d4c\u5957\u7684 JSX \u4ee3\u7801\u6742\u4e71\u7684\u95ee\u9898\uff0c\u4e0d\u8fc7\u76f8\u4fe1\u8fd9\u4e5f\u662f\u76ee\u524d\u5927\u90e8\u5206\u6846\u67b6\u5176\u5b9e\u5df2\u7ecf\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u53ea\u80fd\u8bf4",(0,o.kt)("inlineCode",{parentName:"p"},"useRoutes"),"\u5e2e\u52a9\u8fd9\u4e9b\u6846\u67b6\u9526\u4e0a\u6dfb\u82b1\u4e86\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import { useRoutes } from "react-router-dom";\n\nfunction App() {\n  let element = useRoutes([\n    {\n      path: "/",\n      element: <Dashboard />,\n      children: [\n        {\n          path: "messages",\n          element: <DashboardMessages />,\n        },\n        { path: "tasks", element: <DashboardTasks /> },\n      ],\n    },\n    { path: "team", element: <AboutPage /> },\n  ]);\n\n  return element;\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useRoutes"),"\u5185\u90e8\u4e3b\u8981\u4f1a\u5bf9\u4f20\u5165\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"routes"),"\u6570\u7ec4\u8fdb\u884c\u6241\u5e73\u5316\u5904\u7406\uff0c\u7136\u540e\u6839\u636e\u5f53\u524d\u9875\u9762\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"location.pathname"),"\u548c\u6bcf\u4e2a",(0,o.kt)("inlineCode",{parentName:"p"},"route.path"),"\u8fdb\u884c\u5339\u914d\uff0c\u7b5b\u9009\u51fa\u9700\u8981\u6e32\u67d3\u7684\u7ec4\u4ef6\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'function useRoutes(\n    routes: RouteObject[],\n locationArg?: Partial<Location> | string\n): React.ReactElement | null {\n  // \u83b7\u53d6 LocationContext \u900f\u4f20\u7684\u503c\uff0c\u5305\u62ec location \u5bf9\u8c61\u7684 pathname\uff0csearch \u7b49\u5c5e\u6027\n  let location = useLocation();\n  let pathname = location.pathname || "/";\n  // \u6241\u5e73\u5316\u5904\u7406\u8def\u7531\u7ed3\u6784\uff0c\u5e76\u6839\u636e pathname \u548c route.path \u83b7\u53d6\u5339\u914d\u7684\u7ec4\u4ef6\n  let matches = matchRoutes(routes, { pathname });\n\n  return _renderMatches(\n    matches &&\n    matches.map((match) =>\n      Object.assign({}, match, {\n        params: Object.assign({}, parentParams, match.params),\n        pathname: joinPaths([parentPathnameBase, match.pathname]),\n        pathnameBase:\n        match.pathnameBase === "/"\n        ? parentPathnameBase\n        : joinPaths([parentPathnameBase, match.pathnameBase]),\n        })\n    ),\n    parentMatches\n  );\n}\n\nfunction matchRoutes(\n  routes: RouteObject[],\n  locationArg: Partial<Location> | string,\n  basename = "/"\n): RouteMatch[] | null {\n  let location =\n    typeof locationArg === "string" ? parsePath(locationArg) : locationArg;\n\n  let pathname = stripBasename(location.pathname || "/", basename);\n\n  if (pathname == null) {\n    return null;\n  }\n    \n  // \u6241\u5e73\u5316\u5904\u7406\u8def\u7531\u7ed3\u6784\uff0c\u5f97\u5230\u4ee5\u4e0b\u6570\u636e\u7ed3\u6784\n  let branches = flattenRoutes(routes);\n  // \u6839\u636e score \u6392\u5e8f\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b score \u5c31\u662f Route \u5728 Routes \u5185\u90e8\u7684\u7d22\u5f15\u987a\u5e8f\n  rankRouteBranches(branches);\n\n  let matches = null;\n  for (let i = 0; matches == null && i < branches.length; ++i) {\n    // \u6839\u636e location.pathname \u548c Route \u7684 path \u8fdb\u884c\u5339\u914d\n    matches = matchRouteBranch(branches[i], pathname);\n  }\n\n  return matches;\n}\n')),(0,o.kt)("p",null,"\u5728\u6241\u5e73\u5316\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u4e8e",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u5d4c\u5957\u7684\u60c5\u51b5\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"route.children"),"\u4e2d\u7684\u5b50\u8def\u7531\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"path"),"\u4f1a\u548c\u4e0a\u5c42\u7684\u7236\u8def\u7531\u8fdb\u884c\u62fc\u63a5\u3002\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u5bf9\u4e8e\u5d4c\u5957\u8def\u7531\u7684\u65ad\u8a00\u5904\u7406\uff0c\u5f53\u5d4c\u5957\u7684\u5b50\u8def\u7531\u4ee5",(0,o.kt)("inlineCode",{parentName:"p"},"/"),"\u5f00\u5934\u65f6\uff0c\u5176\u5f00\u5934\u7684\u8def\u5f84\u5fc5\u987b\u548c\u4e0a\u5c42\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u6307\u5b9a\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"path"),"\u76f8\u540c\uff0c\u800c\u5f53",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7684",(0,o.kt)("inlineCode",{parentName:"p"},'path="/"'),"\u7684\u65f6\u5019\uff0c\u5d4c\u5957\u7684\u5b50\u8def\u7531\u7ec4\u4ef6\u5199\u4e0d\u5199",(0,o.kt)("inlineCode",{parentName:"p"},"/"),"\u90fd\u65e0\u6240\u8c13\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'// \u8fd9\u79cd\u60c5\u51b5\u5d4c\u5957\u7684 Route \u7684 path \u53ef\u4ee5\u4e0d\u4ee5 / \u5f00\u5934\n<Route path="/" element={<Dashboard />}>\n  <Route\n    path="messages"\n    element={<DashboardMessages />}\n    />\n  <Route path="tasks" element={<DashboardTasks />} />\n</Route>\n\n// \u8fd9\u79cd\u60c5\u51b5\u5d4c\u5957 messages \u5fc5\u987b\u4ee5 /parent \u5f00\u5934\uff0c\u800c tasks \u4e0d\u4ee5 / \u5f00\u5934\uff0c\u6240\u4ee5\u65e0\u9650\u5236\n<Route path="/parent" element={<Dashboard />}>\n  <Route\n    path="/parent/messages"\n    element={<DashboardMessages />}\n    />\n  <Route path="tasks" element={<DashboardTasks />} />\n</Route>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'// \u6241\u5e73\u5316\u5904\u7406\u8def\u7531\u7ed3\u6784\uff0c\u5f97\u5230\u4ee5\u4e0b\u6570\u636e\u7ed3\u6784\n/**\n  *[\n    {\n      path: string,\n      score: number,\n      routesMeta: [\n        {\n          relativePath: route.path,\n          caseSensitive: route.caseSensitive,\n          childrenIndex: number,\n            route,\n        }\n      ]\n    }\n  ]\n  */\n\nfunction invariant(cond: any, message: string): asserts cond {\n  if (!cond) throw new Error(message);\n}\n\nfunction flattenRoutes(\n  routes: RouteObject[],\n  branches: RouteBranch[] = [],\n  parentsMeta: RouteMeta[] = [],\n  parentPath = ""\n): RouteBranch[] {\n  routes.forEach((route, index) => {\n    let routesMeta: RouteMeta = {\n      relativePath: route.path || "",\n      caseSensitive: route.caseSensitive === true,\n      childrenIndex: index,\n      route,\n    };\n    \n    // \u5904\u7406\u5b50\u8def\u7531\u4ee5 / \u5f00\u5934\u7684\u60c5\u51b5\n    if (meta.relativePath.startsWith("/")) {\n      invariant(\n        meta.relativePath.startsWith(parentPath),\n        `Absolute route path "${meta.relativePath}" nested under path ` +\n          `"${parentPath}" is not valid. An absolute child route path ` +\n          `must start with the combined path of all its parent routes.`\n      );\n\n      meta.relativePath = meta.relativePath.slice(parentPath.length);\n    }\n    \n    // \u7ec4\u5408\u7236\u5c42\u8def\u7531\u8def\u5f84\uff0c\u540c\u65f6\u5c06\u53cd\u659c\u6760 \\ \u90fd\u8f6c\u6362\u6210 /\n    let path = [parentPath, routesMeta.relativePath].join("/").replace(/\\/\\/+/g, "/");\n    if (route.children && route.children.length > 0) {\n      flattenRoutes(route.children, branches, routesMeta, path);\n    }\n    \n    branches.push({ path, score: route.index, routesMeta });\n  });\n    \n  return branches;\n}\n')),(0,o.kt)("p",null,"\u5f97\u5230\u6241\u5e73\u5316\u7684\u8def\u7531\u7ed3\u6784\u4ee5\u540e\uff0c\u4f1a\u6839\u636e",(0,o.kt)("inlineCode",{parentName:"p"},"location.pathname"),"\u548c",(0,o.kt)("inlineCode",{parentName:"p"},"route.path"),"\u8fdb\u884c\u5339\u914d\uff0c\u5339\u914d\u5f97\u5230\u7684\u8def\u7531\u7ed3\u6784\u4f1a\u662f\u5339\u914d\u7684\u4e0a\u5c42",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7ec4\u4ef6\u548c\u5d4c\u5957\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),"\u7684\u5408\u96c6\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'function matchRouteBranch(branch, pathname) {\n  let { routesMeta } = branch;\n  let matches: RouteMatch[] = [];\n  \n  for (let i = 0; i < routesMeta.length; ++i) {\n    let meta = routesMeta[i];\n    let end = i === routesMeta.length - 1;\n    let remainingPathname =\n      matchedPathname === "/"\n        ? pathname\n        : pathname.slice(matchedPathname.length) || "/";\n    // \u5339\u914d\u903b\u8f91\n    let match = matchPath(\n      { path: meta.relativePath, caseSensitive: meta.caseSensitive, end },\n      remainingPathname\n    );\n\n    if (!match) return null;\n    \n    Object.assign(matchedParams, match.params);\n\n    let route = meta.route;\n        \n    // \u5339\u914d\u7684\u8def\u7531\u7ed3\u6784\n    matches.push({\n      params: matchedParams,\n      pathname: joinPaths([matchedPathname, match.pathname]),\n      pathnameBase: normalizePathname(\n        joinPaths([matchedPathname, match.pathnameBase])\n      ),\n      route,\n    });\n\n    if (match.pathnameBase !== "/") {\n      matchedPathname = joinPaths([matchedPathname, match.pathnameBase]);\n    }\n  }\n  \n  return matches;\n}\n')),(0,o.kt)("p",null,"\u5f97\u5230\u5339\u914d\u7684\u8def\u7531\u7ed3\u6784\u4ee5\u540e\uff0c\u56e0\u4e3a\u662f\u6241\u5e73\u7684\u4e00\u7ef4\u6570\u7ec4\u7ed3\u6784\uff0c\u6240\u4ee5\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"reduceRight"),"\u4ece\u5e95\u5c42\u5d4c\u5957\u7684\u8def\u7531\u5f00\u59cb\u904d\u5386\uff0c\u6700\u5185\u5c42",(0,o.kt)("inlineCode",{parentName:"p"},"outlet"),"\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"null"),"\uff0c\u4e8e\u662f\u4f1a\u751f\u6210",(0,o.kt)("inlineCode",{parentName:"p"},"route.element"),"\uff0c\u7136\u540e\u5982\u679c\u4e0a\u5c42",(0,o.kt)("inlineCode",{parentName:"p"},"route"),"\u6709",(0,o.kt)("inlineCode",{parentName:"p"},"element"),"\u5219\u6e32\u67d3",(0,o.kt)("inlineCode",{parentName:"p"},"element"),"\uff0c\u5c06",(0,o.kt)("inlineCode",{parentName:"p"},"outlet"),"\u901a\u8fc7",(0,o.kt)("inlineCode",{parentName:"p"},"Context"),"\u4f20\u9012\u4e0b\u53bb\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u6e32\u67d3",(0,o.kt)("inlineCode",{parentName:"p"},"outlet"),"\u3002"),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u6700\u540e\u6e32\u67d3\u51fa\u6765\u7684\u6240\u6709\u7ec4\u4ef6\u90fd\u4f1a\u88ab",(0,o.kt)("inlineCode",{parentName:"p"},"RouteContext.Provider"),"\u5305\u88f9\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const RouteContext = React.createContext<RouteContextObject>({\n  outlet: null,\n  matches: [],\n});\n\n// \u6e32\u67d3\u5339\u914d\u7684\u7ec4\u4ef6\nfunction _renderMatches(\n  matches: RouteMatch[] | null,\n  parentMatches: RouteMatch[] = []\n): React.ReactElement | null {\n  if (matches == null) return null;\n\n  return matches.reduceRight((outlet, match, index) => {\n    return (\n      <RouteContext.Provider\n        children={\n          match.route.element !== undefined ? match.route.element : outlet\n        }\n        value={{\n          outlet,\n          matches: parentMatches.concat(matches.slice(0, index + 1)),\n        }}\n      />\n    );\n  }, null as React.ReactElement | null);\n}\n")),(0,o.kt)("p",null,"\u901a\u8fc7 react-devtool \u89c2\u5bdf\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"RouteContext.Provider"),"\u5411\u4e0b\u900f\u4f20\u7684\u503c\u4e3a\u4ee5\u4e0b\u7ed3\u6784\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20220313155440948",src:t(97578).Z,width:"731",height:"658"})),(0,o.kt)("h3",{id:"usenavigate"},"useNavigate"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"declare function useNavigate(): NavigateFunction;\n\ninterface Path {\n  pathname: string;\n  search: string;\n  hash: string;\n}\n\ntype To = string | Partial<Path>;\n\ninterface NavigateFunction {\n  (\n    to: To,\n    options?: { replace?: boolean; state?: any }\n  ): void;\n  (delta: number): void;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useNavigate"),"\u66ff\u4ee3\u4e86\u4e4b\u524d\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"useHistory"),"\u7528\u6765\u8fdb\u884c\u8def\u7531\u8df3\u8f6c\u64cd\u4f5c\u3002"),(0,o.kt)("h3",{id:"useparams"},"useParams"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"declare function useParams<\n  K extends string = string\n>(): Readonly<Params<K>>;\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useParams"),"\u7528\u4e8e\u83b7\u53d6\u8def\u5f84\u4e2d\u7684\u53c2\u6570\u503c\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u3002"),(0,o.kt)("h3",{id:"usesearchparams"},"useSearchParams"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"declare function useSearchParams(\n  defaultInit?: URLSearchParamsInit\n): [URLSearchParams, SetURLSearchParams];\n\ntype ParamKeyValuePair = [string, string];\n\ntype URLSearchParamsInit =\n  | string\n  | ParamKeyValuePair[]\n  | Record<string, string | string[]>\n  | URLSearchParams;\n\ntype SetURLSearchParams = (\n  nextInit?: URLSearchParamsInit,\n  navigateOpts?: : { replace?: boolean; state?: any }\n) => void;\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useSearchParams"),"\u7528\u4e8e\u8bfb\u53d6\u6216\u8bbe\u7f6e URL \u7684",(0,o.kt)("inlineCode",{parentName:"p"},"queryString"),"\u90e8\u5206\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useSearchParams"),"\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"p"},"url"),"\u6216\u8005\u4e00\u4e2a\u952e\u503c\u5bf9\u6570\u7ec4\u4f5c\u4e3a\u53c2\u6570\uff0c\u7136\u540e\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"URLSearchParams"),"\u7c7b\u578b\u7684\u5bf9\u8c61\uff1b\u7b2c\u4e8c\u4e2a\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e URL \u7684",(0,o.kt)("inlineCode",{parentName:"p"},"queryString"),"\u90e8\u5206\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useSearchParams"),"\u5185\u90e8\u903b\u8f91\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"location.search"),"\u521d\u59cb\u5316\u4e00\u4e2a",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams/URLSearchParams"},(0,o.kt)("inlineCode",{parentName:"a"},"URLSearchParams")," API")," \u5bf9\u8c61\u3002\u4f46\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"URLSearchParams")," API \u65e0\u6cd5\u517c\u5bb9 IE \u6d4f\u89c8\u5668\uff0c\u6240\u4ee5\u5982\u679c\u4f7f\u7528\u9700\u8981\u5f15\u5165 polyfill\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'function useSearchParams(defaultInit?: URLSearchParamsInit) {\n  // \u8b66\u544a IE \u517c\u5bb9\u6027\n  warning(\n    typeof URLSearchParams !== "undefined",\n    `You cannot use the \\`useSearchParams\\` hook in a browser that does not ` +\n      `support the URLSearchParams API. If you need to support Internet ` +\n      `Explorer 11, we recommend you load a polyfill such as ` +\n      `https://github.com/ungap/url-search-params\\n\\n` +\n      `If you\'re unsure how to load polyfills, we recommend you check out ` +\n      `https://polyfill.io/v3/ which provides some recommendations about how ` +\n      `to load polyfills only for users that need them, instead of for every ` +\n      `user.`\n  );\n\n  // \u57fa\u4e8e\u4f20\u5165\u7684\u53c2\u6570\u521b\u5efa URLSearchParams \u5bf9\u8c61\n  let defaultSearchParamsRef = React.useRef(createSearchParams(defaultInit));\n\n  let location = useLocation();\n  let searchParams = React.useMemo(() => {\n    // \u57fa\u4e8e location.search \u521b\u5efa URLSearchParams \u5bf9\u8c61\n    let searchParams = createSearchParams(location.search);\n\n    for (let key of defaultSearchParamsRef.current.keys()) {\n      if (!searchParams.has(key)) {\n        defaultSearchParamsRef.current.getAll(key).forEach((value) => {\n          searchParams.append(key, value);\n        });\n      }\n    }\n\n    return searchParams;\n  }, [location.search]);\n\n  let navigate = useNavigate();\n  let setSearchParams = React.useCallback(\n    (\n      nextInit: URLSearchParamsInit,\n      navigateOptions?: { replace?: boolean; state?: any }\n    ) => {\n        // \u8fd9\u91cc + \u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff0c\u4f1a\u76f4\u63a5\u8c03\u7528 URLSearchParams \u5bf9\u8c61\u7684 toString \u65b9\u6cd5\n      navigate("?" + createSearchParams(nextInit), navigateOptions);\n    },\n    [navigate]\n  );\n\n  return [searchParams, setSearchParams] as const;\n}\n\n// \u521d\u59cb\u5316 URLSearchParams \u5bf9\u8c61\nfunction createSearchParams(\n  init: URLSearchParamsInit = ""\n): URLSearchParams {\n  return new URLSearchParams(\n    typeof init === "string" ||\n    Array.isArray(init) ||\n    init instanceof URLSearchParams\n      ? init\n      : Object.keys(init).reduce((memo, key) => {\n          let value = init[key];\n          return memo.concat(\n            Array.isArray(value) ? value.map((v) => [key, v]) : [[key, value]]\n          );\n        }, [] as ParamKeyValuePair[])\n  );\n}\n')),(0,o.kt)("h3",{id:"uselocation"},"useLocation"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"declare function useLocation(): Location;\n\ninterface Path {\n  pathname: string;\n  search: string;\n  hash: string;\n}\n\ninterface Location extends Path {\n  state: unknown;\n  key: string;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useLocation"),"\u83b7\u53d6",(0,o.kt)("a",{parentName:"p",href:"https://github.com/remix-run/history"},(0,o.kt)("inlineCode",{parentName:"a"},"history"),"\u5e93"),"\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"location"),"\u5bf9\u8c61\u3002"))}h.isMDXComponent=!0},3373:function(e,n,t){n.Z=t.p+"assets/images/image-20220313150533341-fc403367e266bea4b93ed4ae02fdd905.png"},97578:function(e,n,t){n.Z=t.p+"assets/images/image-20220313155440948-54a6c0961e1cb3cb9a75638e6ee003bd.png"}}]);