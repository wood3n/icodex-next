<!doctype html>
<html lang="zh-CN" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">vuecli源码解析(1) | icodex</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://icodex.me/2022/01/23/vuecli源码解析1"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="frontend, react, javascript, css, react, vue, typescript, docusaurus, blog, personal blog, personal website"><meta data-rh="true" property="og:title" content="vuecli源码解析(1) | icodex"><meta data-rh="true" name="description" content="image-20220122161749258"><meta data-rh="true" property="og:description" content="image-20220122161749258"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-23T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/wood3n"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://icodex.me/2022/01/23/vuecli源码解析1"><link data-rh="true" rel="alternate" href="https://icodex.me/2022/01/23/vuecli源码解析1" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://icodex.me/2022/01/23/vuecli源码解析1" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GMKEEJO8X4-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="icodex RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="icodex Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153188913-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-153188913-1",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="icodex" href="/opensearch.xml">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.596c1d98.css">
<link rel="preload" href="/assets/js/runtime~main.37c10f68.js" as="script">
<link rel="preload" href="/assets/js/main.777d231b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="icodex" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="icodex" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">icodex</b></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/pages/project">My Project</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Skill</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/javascript/guides">JavaScript</a></li><li><a class="dropdown__link" href="/docs/css/guides">CSS</a></li><li><a class="dropdown__link" href="/docs/typescript">TypeScript</a></li><li><a class="dropdown__link" href="/docs/react/guides">React</a></li><li><a class="dropdown__link" href="/docs/nodejs/awesome-nodejs">NodeJS</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/network/guides">Network</a></li><li><a class="dropdown__link" href="/docs/algorithm/算法分析">Algorithm</a></li><li><a class="dropdown__link" href="/docs/interview/guides">Interview</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/engineer/guides">Engineer</a><a class="navbar__item navbar__link" href="/docs/tools/git">Tool</a><a href="https://github.com/wood3n/icodex-next" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/shadcn">shadcn-ui实现原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ts-global-defination">TypeScript全局类型定义的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/intersection">IntersectionObserver API 用法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/webimage3">web图像格式对比（三）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/webimage4">web图像格式对比（四）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/webimage1">web图像格式对比（一）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/webimage2">web图像格式对比（二）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mixcontent">混合内容请求限制</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pna">私有网络访问限制</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/tainted_canvas">canvas 污染问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/dstcloudserver">饥荒云服务器搭建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/packlib">如何给类库打包</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/promiseall">实现 Promise.all 有哪些要点</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pureesm">PureEsm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/learncli">学习vuecli源码的收获</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/2022/01/23/vuecli源码解析1">vuecli源码解析(1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/01/23/vuecli源码解析2">vuecli源码解析(2)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/01/23/vuecli源码解析3">vuecli源码解析(3)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/01/23/vuecli源码解析4">vuecli源码解析(4)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/01/05/webpack监听代理地址修改自动重启devServer">webpack监听代理地址修改自动重启devServer</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">vuecli源码解析(1)</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-01-23T00:00:00.000Z" itemprop="datePublished">2022年1月23日</time> · <!-- -->阅读需 19 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/wood3n" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://raw.githubusercontent.com/wood3n/wood3n/master/31716713.jpg" alt="Oxygen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/wood3n" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Oxygen</span></a></div><small class="avatar__subtitle" itemprop="description">Front End Engineer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="image-20220122161749258" src="/assets/images/image-20220122161749258-383f62ef576a853b9ae26397291e6d3f.png" width="988" height="563" class="img_ev3q"></p><p><code>vue-cli</code>是 vue 官方出品的脚手架项目，用来快速搭建<code>vue</code>项目，一键生成项目基础代码。</p><p>一直对其内部的运行原理比较好奇，并且开发脚手架的能力也是一名前端开发人员需要掌握的技能，所以这里以<code>v4.5.15</code>版本为例，记录一下源码研究的过程和学习点。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="入口">入口<a class="hash-link" href="#入口" title="标题的直接链接">​</a></h2><p><code>vue-cli</code>采用的仍然是通过<code>lerna</code>管理的 monorepo，不知道未来会不会迁移到 pnpm，从<code>package.json</code>可以看到核心仓库就是以下三个，其中<code>@vue</code>就是一些核心代码，包括脚手架<code>@vue/cli</code>、<code>vue-cli-service</code>以及一些插件。</p><p><img loading="lazy" alt="image-20220122103920356" src="/assets/images/image-20220122103920356-e89179755b064eeedf19b5d580f7cc1c.png" width="763" height="141" class="img_ev3q"></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">vue-cli</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─ docs                                                 // 文档</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─ packages                                         </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    ├─ @vue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ babel-preset-app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli                                // @vue/cli</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-init</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-overlay</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-babel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-e2e-cypress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-e2e-nightwatch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-e2e-webdriverio</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-eslint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-pwa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-router</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-typescript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-unit-jest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-unit-mocha</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-plugin-vuex</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-service                // vue-cli-service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-shared-utils</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-test-utils         // 一些第三库的源代码，或者一些工具函数等</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-ui</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    ├─ cli-ui-addon-webpack</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    │    └─ cli-ui-addon-widgets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├─ scripts                                          // 一些管理monorepo的程序</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vuecli">@vue/cli<a class="hash-link" href="#vuecli" title="标题的直接链接">​</a></h2><p>先从脚手架启动引导程序<code>@vue/cli</code>开始分析，从<code>package.json</code>注册的<code>bin</code>属性找到入口程序为<code>bin/vue.js</code>.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;bin&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;vue&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;bin/vue.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="检查nodejs版本">检查Nodejs版本<a class="hash-link" href="#检查nodejs版本" title="标题的直接链接">​</a></h3><p>首先会通过<code>semver</code>这个库检查使用者本地 Nodejs 的版本和在<code>@vue/cli</code>的<code>package.json</code>下要求的版本是否符合。</p><p><img loading="lazy" alt="image-20220122105655018" src="/assets/images/image-20220122105655018-2a59e01ca4a44436ff6c9418216d8237.png" width="751" height="310" class="img_ev3q"></p><p>这里简单了解下 Nodejs 的版本管理，Nodejs 版本有以下几种：</p><ul><li><code>CURRENT</code>：当前状态，也就是当前最新的 Nodejs 版本，<code>ACTIVE</code>版本的 Nodejs 会维护持续 6 个月时间，6 个月之后奇数版本会不再维护，而偶数版本会变成<code>ACTIVE</code>状态的<code>LTS</code>版本</li><li><code>ACTIVE</code>：活跃状态，是正在积极维护和升级的版本，包括一些 BUG 修复，功能改进等</li><li><code>MAINTENANCE</code>：维护状态，只修复 BUG，维护时间不定</li><li><code>EOL</code>：End of Life，也就是终止维护的版本</li><li><code>LTS</code>：long-term support，也就是长期维护版本，这意味着重大的 Bug 将在后续的 30 个月内持续得到不断地修复。</li></ul><p>如下图所示，Nodejs 12 已进入维护状态，并且在 2022 年 4 月份就会终止维护，到时候Nodejs 18 也会发布，Nodejs 17 也会终止维护。 反正一个原则是始终用 LTS 版本就行了。可以使用<code>nvm</code>便捷的管理 Nodejs 的版本。</p><p><img loading="lazy" alt="Releases" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iNTAwIj48ZGVmcz48c3R5bGU+LmN1cnJlbnR7ZmlsbDojMmFhNzQ4fS5hY3RpdmV7ZmlsbDojNDdiNGZmfS5tYWludGVuYW5jZSwudGljayB0ZXh0e2ZpbGw6Izg5YTE5ZH0udW5zdGFibGV7ZmlsbDojZmZiODAwfS5iYXItam9pbiwubGFiZWx7ZmlsbDojZmZmfS5iYXItam9pbi5jdXJyZW50e2Rpc3BsYXk6bm9uZX0udGljayB0ZXh0e2ZvbnQ6MTZweCBzYW5zLXNlcmlmfS5heGlzLS15IC50aWNrIHRleHR7dGV4dC1hbmNob3I6ZW5kfS5sYWJlbHtmb250OjIwcHggc2Fucy1zZXJpZjtmb250LXdlaWdodDoxMDA7dGV4dC1hbmNob3I6c3RhcnQ7ZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZX08L3N0eWxlPjwvZGVmcz48ZyBpZD0iYmFyLWNvbnRhaW5lciI+PGcgY2xhc3M9ImF4aXMgYXhpcy0teCIgZmlsbD0ibm9uZSIgZm9udC1zaXplPSIxMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPjxnIGNsYXNzPSJ0aWNrIj48cGF0aCBzdHJva2U9IiM4OWExOWQiIGQ9Ik0uNSAwdjQ0MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQ1LjE5NSAzMCkiLz48dGV4dCBmaWxsPSIjMDAwIiB4PSIuNSIgZHk9Ii0xMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQ1LjE5NSAzMCkiPkp1bCAyMDIxPC90ZXh0PjwvZz48ZyBjbGFzcz0idGljayI+PHBhdGggc3Ryb2tlPSIjODlhMTlkIiBzdHJva2UtZGFzaGFycmF5PSIyLDIiIGQ9Ik0uNSAwdjQ0MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUzLjI3NSAzMCkiLz48dGV4dCBmaWxsPSIjMDAwIiB4PSIuNSIgZHk9Ii0xMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUzLjI3NSAzMCkiPk9jdCAyMDIxPC90ZXh0PjwvZz48ZyBjbGFzcz0idGljayI+PHBhdGggc3Ryb2tlPSIjODlhMTlkIiBkPSJNLjUgMHY0NDAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM2MS40MDQgMzApIi8+PHRleHQgZmlsbD0iIzAwMCIgeD0iLjUiIGR5PSItMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM2MS40MDQgMzApIj5KYW4gMjAyMjwvdGV4dD48L2c+PGcgY2xhc3M9InRpY2siPjxwYXRoIHN0cm9rZT0iIzg5YTE5ZCIgc3Ryb2tlLWRhc2hhcnJheT0iMiwyIiBkPSJNLjUgMHY0NDAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ2Ny4wODYgMzApIi8+PHRleHQgZmlsbD0iIzAwMCIgeD0iLjUiIGR5PSItMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ2Ny4wODYgMzApIj5BcHIgMjAyMjwvdGV4dD48L2c+PGcgY2xhc3M9InRpY2siPjxwYXRoIHN0cm9rZT0iIzg5YTE5ZCIgZD0iTS41IDB2NDQwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NzMuOTkxIDMwKSIvPjx0ZXh0IGZpbGw9IiMwMDAiIHg9Ii41IiBkeT0iLTEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NzMuOTkxIDMwKSI+SnVsIDIwMjI8L3RleHQ+PC9nPjxnIGNsYXNzPSJ0aWNrIj48cGF0aCBzdHJva2U9IiM4OWExOWQiIHN0cm9rZS1kYXNoYXJyYXk9IjIsMiIgZD0iTS41IDB2NDQwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2ODIuMDcxIDMwKSIvPjx0ZXh0IGZpbGw9IiMwMDAiIHg9Ii41IiBkeT0iLTEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2ODIuMDcxIDMwKSI+T2N0IDIwMjI8L3RleHQ+PC9nPjxnIGNsYXNzPSJ0aWNrIj48cGF0aCBzdHJva2U9IiM4OWExOWQiIGQ9Ik0uNSAwdjQ0MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzkwLjIgMzApIi8+PHRleHQgZmlsbD0iIzAwMCIgeD0iLjUiIGR5PSItMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDc5MC4yIDMwKSI+SmFuIDIwMjM8L3RleHQ+PC9nPjxnIGNsYXNzPSJ0aWNrIj48cGF0aCBzdHJva2U9IiM4OWExOWQiIHN0cm9rZS1kYXNoYXJyYXk9IjIsMiIgZD0iTS41IDB2NDQwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4OTUuODgyIDMwKSIvPjx0ZXh0IGZpbGw9IiMwMDAiIHg9Ii41IiBkeT0iLTEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4OTUuODgyIDMwKSI+QXByIDIwMjM8L3RleHQ+PC9nPjwvZz48ZyBjbGFzcz0iYXhpcyBheGlzLS15IiBmaWxsPSJub25lIiBmb250LXNpemU9IjEwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiI+PGcgY2xhc3M9InRpY2siPjxwYXRoIHN0cm9rZT0iI2UxZTdlNyIgZD0iTTAgLjVoODIwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgNzUuMzk3KSIvPjx0ZXh0IGZpbGw9IiMwMDAiIHk9Ii41IiBkeT0iLjMyZW0iIGR4PSItMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCA3NS4zOTcpIj5NYXN0ZXI8L3RleHQ+PC9nPjxnIGNsYXNzPSJ0aWNrIj48cGF0aCBzdHJva2U9IiNlMWU3ZTciIGQ9Ik0wIC41aDgyMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDE0NS4yMzgpIi8+PHRleHQgZmlsbD0iIzAwMCIgeT0iLjUiIGR5PSIuMzJlbSIgZHg9Ii0xMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDE0NS4yMzgpIj5Ob2RlLmpzIDEyPC90ZXh0PjwvZz48ZyBjbGFzcz0idGljayI+PHBhdGggc3Ryb2tlPSIjZTFlN2U3IiBkPSJNMCAuNWg4MjAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAyMTUuMDgpIi8+PHRleHQgZmlsbD0iIzAwMCIgeT0iLjUiIGR5PSIuMzJlbSIgZHg9Ii0xMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDIxNS4wOCkiPk5vZGUuanMgMTQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJ0aWNrIj48cGF0aCBzdHJva2U9IiNlMWU3ZTciIGQ9Ik0wIC41aDgyMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDI4NC45MikiLz48dGV4dCBmaWxsPSIjMDAwIiB5PSIuNSIgZHk9Ii4zMmVtIiBkeD0iLTEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMjg0LjkyKSI+Tm9kZS5qcyAxNjwvdGV4dD48L2c+PGcgY2xhc3M9InRpY2siPjxwYXRoIHN0cm9rZT0iI2UxZTdlNyIgZD0iTTAgLjVoODIwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzU0Ljc2MikiLz48dGV4dCBmaWxsPSIjMDAwIiB5PSIuNSIgZHk9Ii4zMmVtIiBkeD0iLTEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzU0Ljc2MikiPk5vZGUuanMgMTc8L3RleHQ+PC9nPjxnIGNsYXNzPSJ0aWNrIj48cGF0aCBzdHJva2U9IiNlMWU3ZTciIGQ9Ik0wIC41aDgyMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDQyNC42MDMpIi8+PHRleHQgZmlsbD0iIzAwMCIgeT0iLjUiIGR5PSIuMzJlbSIgZHg9Ii0xMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDQyNC42MDMpIj5Ob2RlLmpzIDE4PC90ZXh0PjwvZz48cGF0aCBzdHJva2U9IiM4OWExOWQiIGQ9Ik0wIDQ0MGg4MjAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiLz48L2c+PHBhdGggY2xhc3M9ImJhciB1bnN0YWJsZSIgZD0iTTAgMjAuOTUyaDgyMHY0OC44ODlIMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiLz48dGV4dCBjbGFzcz0ibGFiZWwiIHg9IjE1IiB5PSI0Ny4zOTciIHN0eWxlPSJvcGFjaXR5OjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiPnVuc3RhYmxlPC90ZXh0PjxwYXRoIGNsYXNzPSJiYXIgbWFpbnRlbmFuY2UiIGQ9Ik0wIDkwLjc5NGgzOTEuMjAzdjQ4Ljg4OUgweiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDMwKSIvPjx0ZXh0IGNsYXNzPSJsYWJlbCIgeD0iMTUiIHk9IjExNy4yMzgiIHN0eWxlPSJvcGFjaXR5OjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiPm1haW50ZW5hbmNlPC90ZXh0PjxwYXRoIGNsYXNzPSJiYXIgbWFpbnRlbmFuY2UiIGQ9Ik0xNjQuNDcgMTYwLjYzNUg4MjB2NDguODg5SDE2NC40N3oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiLz48cGF0aCBjbGFzcz0iYmFyLWpvaW4gbWFpbnRlbmFuY2UiIHN0eWxlPSJvcGFjaXR5OjEiIGQ9Ik0xNjMuNDcgMTYwLjYzNWgydjQ4Ljg4OWgtMnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiLz48dGV4dCBjbGFzcz0ibGFiZWwiIHg9IjE3OS40NyIgeT0iMTg3LjA3OSIgc3R5bGU9Im9wYWNpdHk6MSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDMwKSI+bWFpbnRlbmFuY2U8L3RleHQ+PHBhdGggY2xhc3M9ImJhciBhY3RpdmUiIGQ9Ik0wIDE2MC42MzVoMTY0LjQ3djQ4Ljg4OUgweiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDMwKSIvPjx0ZXh0IGNsYXNzPSJsYWJlbCIgeD0iMTUiIHk9IjE4Ny4wNzkiIHN0eWxlPSJvcGFjaXR5OjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiPmFjdGl2ZTwvdGV4dD48cGF0aCBjbGFzcz0iYmFyIG1haW50ZW5hbmNlIiBkPSJNNTkyLjA5MiAyMzAuNDc2SDgyMHY0OC44ODlINTkyLjA5MnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiLz48cGF0aCBjbGFzcz0iYmFyLWpvaW4gbWFpbnRlbmFuY2UiIHN0eWxlPSJvcGFjaXR5OjEiIGQ9Ik01OTEuMDkyIDIzMC40NzZoMnY0OC44ODloLTJ6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIi8+PHRleHQgY2xhc3M9ImxhYmVsIiB4PSI2MDcuMDkyIiB5PSIyNTYuOTIxIiBzdHlsZT0ib3BhY2l0eToxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIj5tYWludGVuYW5jZTwvdGV4dD48Zz48cGF0aCBjbGFzcz0iYmFyIGFjdGl2ZSIgZD0iTTE3Mi42OTMgMjMwLjQ3Nmg0MTkuMzk4djQ4Ljg4OUgxNzIuNjkzeiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDMwKSIvPjxwYXRoIGNsYXNzPSJiYXItam9pbiBhY3RpdmUiIHN0eWxlPSJvcGFjaXR5OjEiIGQ9Ik0xNzEuNjkzIDIzMC40NzZoMnY0OC44ODloLTJ6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIi8+PHRleHQgY2xhc3M9ImxhYmVsIiB4PSIxODcuNjkzIiB5PSIyNTYuOTIxIiBzdHlsZT0ib3BhY2l0eToxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIj5hY3RpdmU8L3RleHQ+PC9nPjxnPjxwYXRoIGNsYXNzPSJiYXIgY3VycmVudCIgZD0iTTAgMjMwLjQ3NmgxNzIuNjkzdjQ4Ljg4OUgweiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDMwKSIvPjx0ZXh0IGNsYXNzPSJsYWJlbCIgeD0iMTUiIHk9IjI1Ni45MjEiIHN0eWxlPSJvcGFjaXR5OjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiPmN1cnJlbnQ8L3RleHQ+PC9nPjxnPjxwYXRoIGNsYXNzPSJiYXIgbWFpbnRlbmFuY2UiIGQ9Ik0zNTcuMTM1IDMwMC4zMTdoNzEuNjYydjQ4Ljg4OWgtNzEuNjYyeiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDMwKSIvPjxwYXRoIGNsYXNzPSJiYXItam9pbiBtYWludGVuYW5jZSIgc3R5bGU9Im9wYWNpdHk6MSIgZD0iTTM1Ni4xMzUgMzAwLjMxN2gydjQ4Ljg4OWgtMnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiLz48L2c+PGc+PHBhdGggY2xhc3M9ImJhciBjdXJyZW50IiBkPSJNMTY0LjQ3IDMwMC4zMTdoMTkyLjY2NXY0OC44ODlIMTY0LjQ3eiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEwIDMwKSIvPjx0ZXh0IGNsYXNzPSJsYWJlbCIgeD0iMTc5LjQ3IiB5PSIzMjYuNzYyIiBzdHlsZT0ib3BhY2l0eToxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIj5jdXJyZW50PC90ZXh0PjwvZz48Zz48cGF0aCBjbGFzcz0iYmFyIGFjdGl2ZSIgZD0iTTYwMC4zMTUgMzcwLjE1OUg4MjB2NDguODg5SDYwMC4zMTV6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIi8+PHBhdGggY2xhc3M9ImJhci1qb2luIGFjdGl2ZSIgc3R5bGU9Im9wYWNpdHk6MSIgZD0iTTU5OS4zMTUgMzcwLjE1OWgydjQ4Ljg4OWgtMnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiLz48dGV4dCBjbGFzcz0ibGFiZWwiIHg9IjYxNS4zMTUiIHk9IjM5Ni42MDMiIHN0eWxlPSJvcGFjaXR5OjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMCAzMCkiPmFjdGl2ZTwvdGV4dD48L2c+PGc+PHBhdGggY2xhc3M9ImJhciBjdXJyZW50IiBkPSJNMzc4LjI4MSAzNzAuMTU5aDIyMi4wMzR2NDguODg5SDM3OC4yODF6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIi8+PHRleHQgY2xhc3M9ImxhYmVsIiB4PSIzOTMuMjgxIiB5PSIzOTYuNjAzIiBzdHlsZT0ib3BhY2l0eToxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTAgMzApIj5jdXJyZW50PC90ZXh0PjwvZz48L2c+PC9zdmc+" width="960" height="500" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注册命令">注册命令<a class="hash-link" href="#注册命令" title="标题的直接链接">​</a></h3><p>然后使用<code>commanderjs</code>注册命令<code>create</code>，并且包含必填的<code>app-name</code>参数，可以看到<code>create</code>注册以后，会去加载上层<code>lib</code>下的<code>create.js</code>程序，这里还传递了项目名称和额外的 CLI 参数。</p><p><img loading="lazy" alt="image-20220122125035080" src="/assets/images/image-20220122125035080-24427345132120b9bc9ef93da02b990c.png" width="1417" height="545" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="校验项目名称">校验项目名称<a class="hash-link" href="#校验项目名称" title="标题的直接链接">​</a></h3><p><code>create.js</code>内部首先会通过<code>validate-npm-package-name</code>这个库去校验项目名称，并且会额外处理使用<code>.</code>作为当前目录的情况，考虑的非常周到。</p><p><img loading="lazy" alt="image-20220122150200380" src="/assets/images/image-20220122150200380-542f8c4c464b1ddf0a47efb71e6dba44.png" width="1070" height="151" class="img_ev3q"></p><p>如果通过 CLI 指定<code>--merge</code>，则会清空目标文件夹，否则会使用<code>inquirer</code>在 CLI 发起选项选择是否合并目录文件或者选择清空。这里使用了<code>fs-extra</code>来操作文件系统。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化creator实例">初始化Creator实例<a class="hash-link" href="#初始化creator实例" title="标题的直接链接">​</a></h3><p>在确认了目标文件夹以后，会初始化<code>Creator</code>的实例，并传递 CLI 参数来调用实例的<code>create</code>方法。</p><p><img loading="lazy" alt="image-20220122131148494" src="/assets/images/image-20220122131148494-8c1580e427fbf12b2c2529d62a84d835.png" width="1133" height="84" class="img_ev3q"></p><p>这里传递了三个初始化参数：</p><ul><li><code>name</code>：项目名称</li><li><code>targetDir</code>：创建项目的文件夹</li><li><code>getPromptModules()</code>：加载位于上层<code>promptModules</code>文件夹下的一些函数</li></ul><p><img loading="lazy" alt="image-20220122134405339" src="/assets/images/image-20220122134405339-97c651ae244647793dab917a9baef396.png" width="987" height="375" class="img_ev3q"></p><p>位于<code>promptModules</code>下的都是一些用户在创建项目时手动选择的功能项，例如<code>vue</code>的版本，是否使用 TS，CSS预处理器等。</p><p>以<code>../promptModules/babel.js</code>为例，可以看到其内部是一个函数，接收一个<code>cli</code>对象，并且调用了<code>cli</code>对象暴露的<code>injectFeature</code>和<code>onPromptComplete</code>这两个方法。</p><p><img loading="lazy" alt="image-20220122143703009" src="/assets/images/image-20220122143703009-513ef3844ba30f08507530e64a9fdf74.png" width="1120" height="526" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取prompt选项">获取prompt选项<a class="hash-link" href="#获取prompt选项" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="image-20220122132912054" src="/assets/images/image-20220122132912054-be4f13282b0c60743908586426676f87.png" width="1222" height="507" class="img_ev3q"></p><p>在<code>Creator</code>的构造函数内部会初始化一些实例属性：</p><ul><li><p><code>name</code>：项目名称</p></li><li><p><code>context</code>：当前创建的目录</p></li><li><p><code>presetPrompt</code>：<code>preset</code>的选项；通过<code>resolveIntroPrompts</code>获取<code>preset</code>信息，其中包括加载用户创建的保存在本地<code>.vuerc</code>下的<code>preset</code>，以及<code>@vue/cli</code>内置默认的<code>preset</code>信息，然后组合成<code>inquirer</code>选项参数保存在这个属性下</p></li></ul><p><img loading="lazy" alt="image-20220122155504150" src="/assets/images/image-20220122155504150-38f59d0305f5ffad78dd1bd2304e85c0.png" width="1130" height="830" class="img_ev3q"></p><p>默认的<code>preset</code>只有两个：选择<code>vue2</code>和<code>vue3</code>的版本，并且都会包含<code>@vue/cli-plugin-babel</code>和<code>@vue/cli-plugin-eslint</code>两个<code>plugin</code></p><p><img loading="lazy" alt="image-20220122143427655" src="/assets/images/image-20220122143427655-cdedc8637bc125a0aa6acfbbb3d29a60.png" width="1120" height="577" class="img_ev3q"></p><ul><li><code>featurePrompt</code>：如果用户选择不使用任何<code>preset</code>而是手动选择一些功能来创建项目，例如是否使用 TS，选择 CSS 预处理器等，那么就会从<code>featurePrompt</code>加载一些选项</li></ul><p><img loading="lazy" alt="image-20220122135142250" src="/assets/images/image-20220122135142250-6fb804ccbb759927bdba55d812c84d50.png" width="1118" height="625" class="img_ev3q"></p><ul><li><code>outroPrompts</code>：主要是通过<code>inquirer</code>指定的一些选项，例如保存配置文件的方式、选择使用的依赖管理工具npm,yarn,pnpm等</li></ul><p>之后会通过传入当前实例对象<code>this</code>来初始化一个<code>PromptModuleAPI</code>的实例。</p><p><img loading="lazy" alt="image-20220122135843585" src="/assets/images/image-20220122135843585-90887d2e397c38afe1f971a04c3bec80.png" width="889" height="85" class="img_ev3q"></p><p><code>PromptModuleAPI</code>内部会往自身的实例上挂载一个<code>creator</code>对象，也就是<code>Creator</code>的实例，这样在<code>PromptModuleAPI</code>内部的实例就可以通过<code>creator</code>对象访问<code>Creator</code>的实例内部的属性和方法。</p><p><img loading="lazy" alt="image-20220122135238009" src="/assets/images/image-20220122135238009-cbab834c5827e0a82f2b06e69ccce4af.png" width="1022" height="578" class="img_ev3q"></p><p>这时候初始化<code>Creator</code>实例时传入的<code>promptModules</code>内部的每个函数就会被调用，并传入<code>PromptModuleAPI</code>的实例作为参数，每个函数内部通过调用<code>PromptModuleAPI</code>内部的方法再向<code>Creator</code>实例内部的属性注入自身的<code>prompt</code>选项，不得不说逻辑有点绕，但是提高了程序的拓展性，以后<code>@vue/cli</code>内部想拓展一些功能，只需要在<code>promptModules</code>文件夹下编写程序即可。</p><ul><li><code>injectFeature</code>：往实例的<code>featurePrompt.choices</code>推入一些<code>feature</code></li><li><code>injectPrompt</code>：往实例的<code>injectedPrompts</code>推入一些<code>prompt</code></li><li><code>injectOptionForPrompt</code>：往<code>injectedPrompts.choices</code>推入一些选项</li><li><code>onPromptComplete</code>：往实例的<code>promptCompleteCbs</code>推入回调函数，在<code>prompt</code>执行完以后执行</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="组合prompt并获取preset">组合prompt并获取preset<a class="hash-link" href="#组合prompt并获取preset" title="标题的直接链接">​</a></h3><p>初始化<code>Creator</code>实例以后会调用<code>create</code>方法，接收 CLI 命令行指定的所有参数，在使用<code>vue create xx</code>命令没有指定任何其他参数的情况下会进入<code>promptAndResolvePreset</code>方法。<code>promptAndResolvePreset</code>内部主要做了两件事：</p><ul><li>合并<code>Creator</code>实例的<code>presetPrompt</code>，<code>featurePrompt</code>，<code>injectedPrompts</code>以及<code>outroPrompts</code>这些选项，并且默认的选项<code>presetPrompt</code>作为第一个，后续的<code>prompt</code>会通过<code>inquirer</code>的<code>when</code>函数来判断其是否需要执行，如果用户选择不使用<code>preset</code>，那么才会执行后续手动选择<code>feature</code>的部分</li></ul><p><img loading="lazy" alt="image-20220122154431693" src="/assets/images/image-20220122154431693-8b8c773f904db75ccc28434e00b8209a.png" width="976" height="454" class="img_ev3q"></p><ul><li>当用户选择了<code>preset</code>以后，就会通过<code>resolvePreset</code>再次获取<code>preset</code>的信息</li></ul><p><img loading="lazy" alt="image-20220122154736822" src="/assets/images/image-20220122154736822-d551d5312864aad9fc9bcadc882cd9d3.png" width="984" height="80" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注入vue-cli-service">注入vue-cli-service<a class="hash-link" href="#注入vue-cli-service" title="标题的直接链接">​</a></h3><p><code>vue-cli-service</code>在这里也是作为一个<code>plugin</code>，上文获取<code>preset</code>信息以后，会在其默认<code>plugins</code>的基础上再注册<code>vue-cli-service</code></p><p><img loading="lazy" alt="image-20220122160008434" src="/assets/images/image-20220122160008434-71a95cc243476732b86a24c61e0022d7.png" width="893" height="152" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生成packagejson">生成package.json<a class="hash-link" href="#生成packagejson" title="标题的直接链接">​</a></h3><p>获取所有<code>plugin</code>以后，会创建<code>package.json</code>对象，写入<code>plugin</code>的版本，并生成文件</p><p><img loading="lazy" alt="image-20220122161035813" src="/assets/images/image-20220122161035813-d08a5b88545c3059628ce0a5d0a5903a.png" width="1081" height="851" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化git">初始化git<a class="hash-link" href="#初始化git" title="标题的直接链接">​</a></h3><p>如果通过 CLI 指定初始化 git，这里还会调用<code>git init</code>命令，初始化 git 本地存储服务。</p><p><img loading="lazy" alt="image-20220123221844974" src="/assets/images/image-20220123221844974-d78075b1046217f1d268c52d278f9166.png" width="1129" height="151" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装依赖">安装依赖<a class="hash-link" href="#安装依赖" title="标题的直接链接">​</a></h3><p><code>@vue/cli</code>内部定义了依赖管理基类<code>PackageManager</code>，内部会判断客户端使用的依赖管理工具，使用的源地址等信息，代码很多，就不一一展开了。这里安装的依赖从前面来看主要有三个：</p><ul><li><code>@vue/cli-plugin-babel</code></li><li><code>@vue/cli-plugin-eslint</code></li><li><code>@vue/cli-service</code></li></ul><p><img loading="lazy" alt="image-20220123222843578" src="/assets/images/image-20220123222843578-5b0503cf895dd9cefa7dccaf82db2e69.png" width="1099" height="280" class="img_ev3q"></p></div></article><div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/learncli"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">学习vuecli源码的收获</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2022/01/23/vuecli源码解析2"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">vuecli源码解析(2)</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#入口" class="table-of-contents__link toc-highlight">入口</a></li><li><a href="#vuecli" class="table-of-contents__link toc-highlight">@vue/cli</a><ul><li><a href="#检查nodejs版本" class="table-of-contents__link toc-highlight">检查Nodejs版本</a></li><li><a href="#注册命令" class="table-of-contents__link toc-highlight">注册命令</a></li><li><a href="#校验项目名称" class="table-of-contents__link toc-highlight">校验项目名称</a></li><li><a href="#初始化creator实例" class="table-of-contents__link toc-highlight">初始化Creator实例</a></li><li><a href="#获取prompt选项" class="table-of-contents__link toc-highlight">获取prompt选项</a></li><li><a href="#组合prompt并获取preset" class="table-of-contents__link toc-highlight">组合prompt并获取preset</a></li><li><a href="#注入vue-cli-service" class="table-of-contents__link toc-highlight">注入vue-cli-service</a></li><li><a href="#生成packagejson" class="table-of-contents__link toc-highlight">生成package.json</a></li><li><a href="#初始化git" class="table-of-contents__link toc-highlight">初始化git</a></li><li><a href="#安装依赖" class="table-of-contents__link toc-highlight">安装依赖</a></li></ul></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.37c10f68.js"></script>
<script src="/assets/js/main.777d231b.js"></script>
</body>
</html>